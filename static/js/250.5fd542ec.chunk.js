"use strict";(self.webpackChunksyncswap=self.webpackChunksyncswap||[]).push([[250],{9250:function(e,t,n){n.r(t),n.d(t,{EthereumProvider:function(){return Vi},OPTIONAL_EVENTS:function(){return _i},OPTIONAL_METHODS:function(){return Pi},REQUIRED_EVENTS:function(){return Si},REQUIRED_METHODS:function(){return Ii},default:function(){return Ui}});var r=n(29439),i=n(74165),s=n(15861),a=n(15671),o=n(43144),c=n(93433),u=n(4942),p=n(37762),l=n(68041),h=n.n(l),f=n(29219),d=n(24),v=n.n(d),g=n(97326),m=n(60136),y=n(29388),w=n(1413),x=n(60074),b=n(1345),Z=n(91451),k=n(23375),E=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this)).opts=e,r.protocol="wc",r.version=2,r}return(0,o.Z)(n)}(k.q),I=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,a.Z)(this,n),(i=t.call(this)).core=e,i.logger=r,i.records=new Map,i}return(0,o.Z)(n)}(k.q),P=(0,o.Z)((function e(t,n){(0,a.Z)(this,e),this.logger=t,this.core=n})),S=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,a.Z)(this,n),(i=t.call(this)).relayer=e,i.logger=r,i}return(0,o.Z)(n)}(k.q),_=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e){return(0,a.Z)(this,n),t.call(this)}return(0,o.Z)(n)}(k.q),R=(0,o.Z)((function e(t,n,r,i){(0,a.Z)(this,e),this.core=t,this.logger=n,this.name=r})),C=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,a.Z)(this,n),(i=t.call(this)).relayer=e,i.logger=r,i}return(0,o.Z)(n)}(k.q),N=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,a.Z)(this,n),(i=t.call(this)).core=e,i.logger=r,i}return(0,o.Z)(n)}(k.q);h(),l.EventEmitter;function O(e){if("string"!==typeof e)throw new Error("Cannot safe json parse value of type ".concat(typeof e));try{return function(e){var t=e.replace(/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,'$1"$2n"$3');return JSON.parse(t,(function(e,t){return"string"===typeof t&&t.match(/^\d+n$/)?BigInt(t.substring(0,t.length-1)):t}))}(e)}catch(t){return e}}function q(e){return"string"===typeof e?e:(t=e,JSON.stringify(t,(function(e,t){return"bigint"===typeof t?t.toString()+"n":t}))||"");var t}var D,A=n(15650),T=n(91696),M=n(93659),z=n(13730),L="INTERNAL_ERROR",j="SERVER_ERROR",U=[-32700,-32600,-32601,-32602,-32603],V=(D={},(0,u.Z)(D,"PARSE_ERROR",{code:-32700,message:"Parse error"}),(0,u.Z)(D,"INVALID_REQUEST",{code:-32600,message:"Invalid Request"}),(0,u.Z)(D,"METHOD_NOT_FOUND",{code:-32601,message:"Method not found"}),(0,u.Z)(D,"INVALID_PARAMS",{code:-32602,message:"Invalid params"}),(0,u.Z)(D,L,{code:-32603,message:"Internal error"}),(0,u.Z)(D,j,{code:-32e3,message:"Server error"}),D),K=j;function H(e){return U.includes(e)}function G(e){return Object.keys(V).includes(e)?V[e]:V[K]}function J(e){var t=Object.values(V).find((function(t){return t.code===e}));return t||V[K]}n(55503);function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return Date.now()*Math.pow(10,e)+Math.floor(Math.random()*Math.pow(10,e))}function Y(e,t,n){return{id:n||B(),jsonrpc:"2.0",method:e,params:t}}function F(e,t){return{id:e,jsonrpc:"2.0",result:t}}function W(e,t){return"undefined"===typeof e?G(L):("string"===typeof e&&(e=Object.assign(Object.assign({},G(j)),{message:e})),"undefined"!==typeof t&&(e.data=t),H(e.code)&&(e=J(e.code)),e)}n(31379);function Q(e){return"object"===typeof e&&"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function X(e){return Q(e)&&"method"in e}function $(e){return"result"in e}function ee(e){return"error"in e}var te=n(70758),ne=n(31567),re="undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket?n.g.WebSocket:"undefined"!==typeof window&&"undefined"!==typeof window.WebSocket?window.WebSocket:n(78720),ie=function(){function e(t){if((0,a.Z)(this,e),this.url=t,this.events=new l.EventEmitter,this.registering=!1,!(0,ne.isWsUrl)(t))throw new Error("Provided URL is not compatible with WebSocket connection: ".concat(t));this.url=t}return(0,o.Z)(e,[{key:"connected",get:function(){return"undefined"!==typeof this.socket}},{key:"connecting",get:function(){return this.registering}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"removeListener",value:function(e,t){this.events.removeListener(e,t)}},{key:"open",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t,n=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.url,e.next=3,this.register(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){"undefined"!==typeof t.socket?(t.socket.onclose=function(n){t.onClose(n),e()},t.socket.close()):n(new Error("Connection already closed"))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof this.socket){e.next=4;break}return e.next=3,this.register();case 3:this.socket=e.sent;case 4:try{this.socket.send((0,te.u)(t))}catch(n){this.onError(t.id,n)}case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"register",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.url;if(!(0,ne.isWsUrl)(t))throw new Error("Provided URL is not compatible with WebSocket connection: ".concat(t));if(this.registering){var n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((function(t,n){e.events.once("register_error",(function(t){e.resetMaxListeners(),n(t)})),e.events.once("open",(function(){if(e.resetMaxListeners(),"undefined"===typeof e.socket)return n(new Error("WebSocket connection is missing or invalid"));t(e.socket)}))}))}return this.url=t,this.registering=!0,new Promise((function(n,r){var i=(0,ne.isReactNative)()?void 0:{rejectUnauthorized:!(0,ne.isLocalhostUrl)(t)},s=new re(t,[],i);"undefined"!==typeof window?s.onerror=function(t){var n=t;r(e.emitError(n.error))}:s.on("error",(function(t){r(e.emitError(t))})),s.onopen=function(){e.onOpen(s),n(s)}}))}},{key:"onOpen",value:function(e){var t=this;e.onmessage=function(e){return t.onPayload(e)},e.onclose=function(e){return t.onClose(e)},this.socket=e,this.registering=!1,this.events.emit("open")}},{key:"onClose",value:function(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}},{key:"onPayload",value:function(e){if("undefined"!==typeof e.data){var t="string"===typeof e.data?(0,te.D)(e.data):e.data;this.events.emit("payload",t)}}},{key:"onError",value:function(e,t){var n=this.parseError(t),r=n.message||n.toString(),i=(0,ne.formatJsonRpcError)(e,r);this.events.emit("payload",i)}},{key:"parseError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.url;return(0,ne.parseConnectionError)(e,t,"WS")}},{key:"resetMaxListeners",value:function(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}},{key:"emitError",value:function(e){var t=this.parseError(new Error((null===e||void 0===e?void 0:e.message)||"WebSocket connection failed for URL: ".concat(this.url)));return this.events.emit("register_error",t),t}}]),e}(),se=ie,ae=n(23108),oe=n.n(ae);var ce=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),a=s.charCodeAt(0);if(255!==n[a])throw new TypeError(s+" is ambiguous");n[a]=i}var o=e.length,c=e.charAt(0),u=Math.log(o)/Math.log(256),p=Math.log(256)/Math.log(o);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===c;)r++,t++;for(var s=(e.length-t)*u+1>>>0,a=new Uint8Array(s);e[t];){var p=n[e.charCodeAt(t)];if(255===p)return;for(var l=0,h=s-1;(0!==p||l<i)&&-1!==h;h--,l++)p+=o*a[h]>>>0,a[h]=p%256>>>0,p=p/256>>>0;if(0!==p)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===a[f];)f++;for(var d=new Uint8Array(r+(s-f)),v=r;f!==s;)d[v++]=a[f++];return d}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,s=t.length;i!==s&&0===t[i];)i++,n++;for(var a=(s-i)*p+1>>>0,u=new Uint8Array(a);i!==s;){for(var l=t[i],h=0,f=a-1;(0!==l||h<r)&&-1!==f;f--,h++)l+=256*u[f]>>>0,u[f]=l%o>>>0,l=l/o>>>0;if(0!==l)throw new Error("Non-zero carry");r=h,i++}for(var d=a-r;d!==a&&0===u[d];)d++;for(var v=c.repeat(n);d<a;++d)v+=e.charAt(u[d]);return v},decodeUnsafe:l,decode:function(e){var n=l(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}},ue=ce,pe=function(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},le=function(){function e(t,n,r){(0,a.Z)(this,e),this.name=t,this.prefix=n,this.baseEncode=r}return(0,o.Z)(e,[{key:"encode",value:function(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}]),e}(),he=function(){function e(t,n,r){if((0,a.Z)(this,e),this.name=t,this.prefix=n,void 0===n.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}return(0,o.Z)(e,[{key:"decode",value:function(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}},{key:"or",value:function(e){return de(this,e)}}]),e}(),fe=function(){function e(t){(0,a.Z)(this,e),this.decoders=t}return(0,o.Z)(e,[{key:"or",value:function(e){return de(this,e)}},{key:"decode",value:function(e){var t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}]),e}(),de=function(e,t){return new fe((0,w.Z)((0,w.Z)({},e.decoders||(0,u.Z)({},e.prefix,e)),t.decoders||(0,u.Z)({},t.prefix,t)))},ve=function(){function e(t,n,r,i){(0,a.Z)(this,e),this.name=t,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new le(t,n,r),this.decoder=new he(t,n,i)}return(0,o.Z)(e,[{key:"encode",value:function(e){return this.encoder.encode(e)}},{key:"decode",value:function(e){return this.decoder.decode(e)}}]),e}(),ge=function(e){var t=e.name,n=e.prefix,r=e.encode,i=e.decode;return new ve(t,n,r,i)},me=function(e){var t=e.prefix,n=e.name,r=e.alphabet,i=ue(r,n),s=i.encode,a=i.decode;return ge({prefix:t,name:n,encode:s,decode:function(e){return pe(a(e))}})},ye=function(e){var t=e.name,n=e.prefix,r=e.bitsPerChar,i=e.alphabet;return ge({prefix:n,name:t,encode:function(e){return function(e,t,n){for(var r="="===t[t.length-1],i=(1<<n)-1,s="",a=0,o=0,c=0;c<e.length;++c)for(o=o<<8|e[c],a+=8;a>n;)s+=t[i&o>>(a-=n)];if(a&&(s+=t[i&o<<n-a]),r)for(;s.length*n&7;)s+="=";return s}(e,i,r)},decode:function(e){return function(e,t,n,r){for(var i={},s=0;s<t.length;++s)i[t[s]]=s;for(var a=e.length;"="===e[a-1];)--a;for(var o=new Uint8Array(a*n/8|0),c=0,u=0,p=0,l=0;l<a;++l){var h=i[e[l]];if(void 0===h)throw new SyntaxError("Non-".concat(r," character"));u=u<<n|h,(c+=n)>=8&&(c-=8,o[p++]=255&u>>c)}if(c>=n||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return o}(e,i,r,t)}})},we=ge({prefix:"\0",name:"identity",encode:function(e){return function(e){return(new TextDecoder).decode(e)}(e)},decode:function(e){return function(e){return(new TextEncoder).encode(e)}(e)}}),xe=Object.freeze({__proto__:null,identity:we}),be=ye({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ze=Object.freeze({__proto__:null,base2:be}),ke=ye({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Ee=Object.freeze({__proto__:null,base8:ke}),Ie=me({prefix:"9",name:"base10",alphabet:"0123456789"}),Pe=Object.freeze({__proto__:null,base10:Ie}),Se=ye({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),_e=ye({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Re=Object.freeze({__proto__:null,base16:Se,base16upper:_e}),Ce=ye({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ne=ye({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Oe=ye({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),qe=ye({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),De=ye({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ae=ye({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Te=ye({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Me=ye({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ze=ye({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Le=Object.freeze({__proto__:null,base32:Ce,base32upper:Ne,base32pad:Oe,base32padupper:qe,base32hex:De,base32hexupper:Ae,base32hexpad:Te,base32hexpadupper:Me,base32z:ze}),je=me({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ue=me({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ve=Object.freeze({__proto__:null,base36:je,base36upper:Ue}),Ke=me({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),He=me({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ge=Object.freeze({__proto__:null,base58btc:Ke,base58flickr:He}),Je=ye({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Be=ye({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ye=ye({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Fe=ye({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),We=Object.freeze({__proto__:null,base64:Je,base64pad:Be,base64url:Ye,base64urlpad:Fe}),Qe=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),Xe=Qe.reduce((function(e,t,n){return e[n]=t,e}),[]),$e=Qe.reduce((function(e,t,n){return e[t.codePointAt(0)]=n,e}),[]);var et=ge({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce((function(e,t){return e+=Xe[t]}),"")},decode:function(e){var t,n=[],r=(0,p.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,s=$e[i.codePointAt(0)];if(void 0===s)throw new Error("Non-base256emoji character: ".concat(i));n.push(s)}}catch(a){r.e(a)}finally{r.f()}return new Uint8Array(n)}}),tt=Object.freeze({__proto__:null,base256emoji:et}),nt=function e(t,n,r){n=n||[];for(var i=r=r||0;t>=st;)n[r++]=255&t|rt,t/=128;for(;t&it;)n[r++]=255&t|rt,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},rt=128,it=-128,st=Math.pow(2,31);var at=function e(t,n){var r,i=0,s=0,a=n=n||0,o=t.length;do{if(a>=o)throw e.bytes=0,new RangeError("Could not decode varint");r=t[a++],i+=s<28?(r&ct)<<s:(r&ct)*Math.pow(2,s),s+=7}while(r>=ot);return e.bytes=a-n,i},ot=128,ct=127;var ut=Math.pow(2,7),pt=Math.pow(2,14),lt=Math.pow(2,21),ht=Math.pow(2,28),ft=Math.pow(2,35),dt=Math.pow(2,42),vt=Math.pow(2,49),gt=Math.pow(2,56),mt=Math.pow(2,63),yt={encode:nt,decode:at,encodingLength:function(e){return e<ut?1:e<pt?2:e<lt?3:e<ht?4:e<ft?5:e<dt?6:e<vt?7:e<gt?8:e<mt?9:10}},wt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return yt.encode(e,t,n),t},xt=function(e){return yt.encodingLength(e)},bt=function(e,t){var n=t.byteLength,r=xt(e),i=r+xt(n),s=new Uint8Array(i+n);return wt(e,s,0),wt(n,s,r),s.set(t,i),new Zt(e,n,t,s)},Zt=(0,o.Z)((function e(t,n,r,i){(0,a.Z)(this,e),this.code=t,this.size=n,this.digest=r,this.bytes=i})),kt=function(e){var t=e.name,n=e.code,r=e.encode;return new Et(t,n,r)},Et=function(){function e(t,n,r){(0,a.Z)(this,e),this.name=t,this.code=n,this.encode=r}return(0,o.Z)(e,[{key:"digest",value:function(e){var t=this;if(e instanceof Uint8Array){var n=this.encode(e);return n instanceof Uint8Array?bt(this.code,n):n.then((function(e){return bt(t.code,e)}))}throw Error("Unknown type, must be binary type")}}]),e}(),It=function(e){return function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Uint8Array,t.next=3,crypto.subtle.digest(e,n);case 3:return t.t1=t.sent,t.abrupt("return",new t.t0(t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},Pt=kt({name:"sha2-256",code:18,encode:It("SHA-256")}),St=kt({name:"sha2-512",code:19,encode:It("SHA-512")}),_t=Object.freeze({__proto__:null,sha256:Pt,sha512:St}),Rt=pe,Ct={code:0,name:"identity",encode:Rt,digest:function(e){return bt(0,Rt(e))}},Nt=Object.freeze({__proto__:null,identity:Ct});new TextEncoder,new TextDecoder;var Ot=(0,w.Z)((0,w.Z)((0,w.Z)((0,w.Z)((0,w.Z)((0,w.Z)((0,w.Z)((0,w.Z)((0,w.Z)((0,w.Z)({},xe),Ze),Ee),Pe),Re),Le),Ve),Ge),We),tt);function qt(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}(0,w.Z)((0,w.Z)({},_t),Nt);var Dt=qt("utf8","u",(function(e){return"u"+new TextDecoder("utf8").decode(e)}),(function(e){return(new TextEncoder).encode(e.substring(1))})),At=qt("ascii","a",(function(e){for(var t="a",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}),(function(e){for(var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}((e=e.substring(1)).length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t})),Tt=(0,w.Z)({utf8:Dt,"utf-8":Dt,hex:Ot.base16,latin1:At,ascii:At,binary:At},Ot);function Mt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",n=Tt[t];if(!n)throw new Error('Unsupported encoding "'.concat(t,'"'));return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode("".concat(n.prefix).concat(e)):globalThis.Buffer.from(e,"utf8")}var zt,Lt="core",jt="".concat("wc","@",2,":").concat(Lt,":"),Ut="error",Vt={database:":memory:"},Kt="client_ed25519_seed",Ht=M.ONE_DAY,Gt=M.SIX_HOURS,Jt="wss://relay.walletconnect.com",Bt="relayer_message",Yt="relayer_connect",Ft="relayer_disconnect",Wt="relayer_error",Qt="relayer_connection_stalled",Xt="relayer_transport_closed",$t="relayer_publish",en="payload",tn="connect",nn="disconnect",rn="error",sn=M.ONE_SECOND,an="subscription_created",on="subscription_deleted",cn="subscription_sync",un="subscription_resubscribed",pn=(M.THIRTY_DAYS,1e3*M.FIVE_SECONDS),ln=(M.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}}),hn="history_created",fn="history_updated",dn="history_deleted",vn="history_sync",gn="expirer_created",mn="expirer_deleted",yn="expirer_expired",wn="expirer_sync",xn=(M.ONE_DAY,function(){function e(t,n){var r=this;(0,a.Z)(this,e),this.core=t,this.logger=n,this.keychain=new Map,this.name="keychain",this.version="0.3",this.initialized=!1,this.storagePrefix=jt,this.init=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.initialized){e.next=5;break}return e.next=3,r.getKeyChain();case 3:typeof(t=e.sent)<"u"&&(r.keychain=t),r.initialized=!0;case 5:case"end":return e.stop()}}),e)}))),this.has=function(e){return r.isInitialized(),r.keychain.has(e)},this.set=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),r.keychain.set(t,n),e.next=4,r.persist();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.get=function(e){r.isInitialized();var t=r.keychain.get(e);if(typeof t>"u"){var n=(0,f.Z7)("NO_MATCHING_KEY","".concat(r.name,": ").concat(e)).message;throw new Error(n)}return t},this.del=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),r.keychain.delete(t),e.next=4,r.persist();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.core=t,this.logger=(0,Z.generateChildLogger)(n,this.name)}return(0,o.Z)(e,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"setKeyChain",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,(0,f.KC)(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getKeyChain",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return t=e.sent,e.abrupt("return",typeof t<"u"?(0,f.IP)(t):void 0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"persist",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setKeyChain(this.keychain);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,f.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),e}()),bn=function(){function e(t,n,r){var o=this;(0,a.Z)(this,e),this.core=t,this.logger=n,this.name="crypto",this.initialized=!1,this.init=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=o.initialized,e.t0){e.next=5;break}return e.next=4,o.keychain.init();case 4:o.initialized=!0;case 5:case"end":return e.stop()}}),e)}))),this.hasKeys=function(e){return o.isInitialized(),o.keychain.has(e)},this.getClientId=(0,s.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.isInitialized(),e.next=3,o.getClientSeed();case 3:return t=e.sent,n=A.generateKeyPair(t),e.abrupt("return",A.encodeIss(n.publicKey));case 6:case"end":return e.stop()}}),e)}))),this.generateKeyPair=function(){o.isInitialized();var e=(0,f.Au)();return o.setPrivateKey(e.publicKey,e.privateKey)},this.signJWT=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.isInitialized(),e.next=3,o.getClientSeed();case 3:return n=e.sent,r=A.generateKeyPair(n),s=(0,f.jd)(),a=Ht,e.next=9,A.signJWT(s,t,a,r);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.generateSharedKey=function(e,t,n){o.isInitialized();var r=o.getPrivateKey(e),i=(0,f.m$)(r,t);return o.setSymKey(i,n)},this.setSymKey=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.isInitialized(),r=n||(0,f.Ym)(t),e.next=4,o.keychain.set(r,t);case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.deleteKeyPair=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.isInitialized(),e.next=3,o.keychain.del(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteSymKey=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.isInitialized(),e.next=3,o.keychain.del(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.encode=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,r){var s,a,c,u,p,l,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.isInitialized(),s=(0,f.EN)(r),a=q(n),!(0,f.Q8)(s)){e.next=7;break}return c=s.senderPublicKey,u=s.receiverPublicKey,e.next=6,o.generateSharedKey(c,u);case 6:t=e.sent;case 7:return p=o.getSymKey(t),l=s.type,h=s.senderPublicKey,e.abrupt("return",(0,f.HI)({type:l,symKey:p,message:a,senderPublicKey:h}));case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.decode=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,r){var s,a,c,u,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.isInitialized(),s=(0,f.Ll)(n,r),!(0,f.Q8)(s)){e.next=7;break}return a=s.receiverPublicKey,c=s.senderPublicKey,e.next=6,o.generateSharedKey(a,c);case 6:t=e.sent;case 7:return u=o.getSymKey(t),p=(0,f.pe)({symKey:u,encoded:n}),e.abrupt("return",O(p));case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.getPayloadType=function(e){var t=(0,f.vB)(e);return(0,f.WG)(t.type)},this.getPayloadSenderPublicKey=function(e){var t=(0,f.vB)(e);return t.senderPublicKey?(0,T.BB)(t.senderPublicKey,f.AW):void 0},this.core=t,this.logger=(0,Z.generateChildLogger)(n,this.name),this.keychain=r||new xn(this.core,this.logger)}return(0,o.Z)(e,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"setPrivateKey",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keychain.set(t,n);case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPrivateKey",value:function(e){return this.keychain.get(e)}},{key:"getClientSeed",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t="",e.prev=1,t=this.keychain.get(Kt),e.next=10;break;case 5:return e.prev=5,e.t0=e.catch(1),t=(0,f.jd)(),e.next=10,this.keychain.set(Kt,t);case 10:return e.abrupt("return",Mt(t,"base16"));case 11:case"end":return e.stop()}}),e,this,[[1,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"getSymKey",value:function(e){return this.keychain.get(e)}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,f.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),e}(),Zn=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var o;return(0,a.Z)(this,n),(o=t.call(this,e,r)).logger=e,o.core=r,o.messages=new Map,o.name="messages",o.version="0.3",o.initialized=!1,o.storagePrefix=jt,o.init=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.initialized){e.next=15;break}return o.logger.trace("Initialized"),e.prev=2,e.next=5,o.getRelayerMessages();case 5:typeof(t=e.sent)<"u"&&(o.messages=t),o.logger.debug("Successfully Restored records for ".concat(o.name)),o.logger.trace({type:"method",method:"restore",size:o.messages.size}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),o.logger.debug("Failed to Restore records for ".concat(o.name)),o.logger.error(e.t0);case 12:return e.prev=12,o.initialized=!0,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[2,9,12,15]])}))),o.set=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.isInitialized(),r=(0,f.rj)(n),typeof(s=o.messages.get(t))>"u"&&(s={}),e.t0=typeof s[r]<"u",e.t0){e.next=10;break}return s[r]=n,o.messages.set(t,s),e.next=10,o.persist();case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),o.get=function(e){o.isInitialized();var t=o.messages.get(e);return typeof t>"u"&&(t={}),t},o.has=function(e,t){return o.isInitialized(),typeof o.get(e)[(0,f.rj)(t)]<"u"},o.del=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.isInitialized(),o.messages.delete(t),e.next=4,o.persist();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.logger=(0,Z.generateChildLogger)(e,o.name),o.core=r,o}return(0,o.Z)(n,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"setRelayerMessages",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,(0,f.KC)(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelayerMessages",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return t=e.sent,e.abrupt("return",typeof t<"u"?(0,f.IP)(t):void 0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"persist",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRelayerMessages(this.messages);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,f.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),n}(P),kn=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var o;return(0,a.Z)(this,n),(o=t.call(this,e,r)).relayer=e,o.logger=r,o.events=new l.EventEmitter,o.name="publisher",o.queue=new Map,o.publishTimeout=1e4,o.publish=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,r){var s,a,c,u,p,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.logger.debug("Publishing Payload"),o.logger.trace({type:"method",method:"publish",params:{topic:t,message:n,opts:r}}),e.prev=1,s=(null===r||void 0===r?void 0:r.ttl)||Gt,a=(0,f._H)(r),c=(null===r||void 0===r?void 0:r.prompt)||!1,u=(null===r||void 0===r?void 0:r.tag)||0,p={topic:t,message:n,opts:{ttl:s,relay:a,prompt:c,tag:u}},l=(0,f.rj)(n),o.queue.set(l,p),e.prev=4,e.next=7,(0,f.hF)(o.rpcPublish(t,n,s,a,c,u),o.publishTimeout);case 7:return e.next=9,e.sent;case 9:o.relayer.events.emit($t,p),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(4),o.logger.debug("Publishing Payload stalled"),o.relayer.events.emit(Qt),e.abrupt("return");case 16:o.onPublish(l,p),o.logger.debug("Successfully Published Payload"),o.logger.trace({type:"method",method:"publish",params:{topic:t,message:n,opts:r}}),e.next=22;break;case 19:throw e.prev=19,e.t1=e.catch(1),o.logger.debug("Failed to Publish Payload"),o.logger.error(e.t1),e.t1;case 22:case"end":return e.stop()}}),e,null,[[1,19],[4,12]])})));return function(t,n,r){return e.apply(this,arguments)}}(),o.on=function(e,t){o.events.on(e,t)},o.once=function(e,t){o.events.once(e,t)},o.off=function(e,t){o.events.off(e,t)},o.removeListener=function(e,t){o.events.removeListener(e,t)},o.relayer=e,o.logger=(0,Z.generateChildLogger)(r,o.name),o.registerEventListeners(),o}return(0,o.Z)(n,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"rpcPublish",value:function(e,t,n,r,i,s){var a,o,c,u,p={method:(0,f.cO)(r.protocol).publish,params:{topic:e,message:t,ttl:n,prompt:i,tag:s}};return(0,f.o8)(null==(a=p.params)?void 0:a.prompt)&&(null==(o=p.params)||delete o.prompt),(0,f.o8)(null==(c=p.params)?void 0:c.tag)&&(null==(u=p.params)||delete u.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p}),this.relayer.request(p)}},{key:"onPublish",value:function(e,t){this.queue.delete(e)}},{key:"checkQueue",value:function(){var e=this;this.queue.forEach(function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){var r,s,a;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.topic,s=n.message,a=n.opts,t.next=3,e.publish(r,s,a);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerEventListeners",value:function(){var e=this;this.relayer.core.heartbeat.on(b.HEARTBEAT_EVENTS.pulse,(function(){e.checkQueue()}))}}]),n}(S),En=function(){function e(){var t=this;(0,a.Z)(this,e),this.map=new Map,this.set=function(e,n){var r=t.get(e);t.exists(e,n)||t.map.set(e,[].concat((0,c.Z)(r),[n]))},this.get=function(e){return t.map.get(e)||[]},this.exists=function(e,n){return t.get(e).includes(n)},this.delete=function(e,n){if(typeof n>"u")t.map.delete(e);else if(t.map.has(e)){var r=t.get(e);if(t.exists(e,n)){var i=r.filter((function(e){return e!==n}));i.length?t.map.set(e,i):t.map.delete(e)}}},this.clear=function(){t.map.clear()}}return(0,o.Z)(e,[{key:"topics",get:function(){return Array.from(this.map.keys())}}]),e}(),In=Object.defineProperty,Pn=Object.defineProperties,Sn=Object.getOwnPropertyDescriptors,_n=Object.getOwnPropertySymbols,Rn=Object.prototype.hasOwnProperty,Cn=Object.prototype.propertyIsEnumerable,Nn=function(e,t,n){return t in e?In(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},On=function(e,t){for(var n in t||(t={}))Rn.call(t,n)&&Nn(e,n,t[n]);if(_n){var r,i=(0,p.Z)(_n(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Cn.call(t,n)&&Nn(e,n,t[n])}}catch(s){i.e(s)}finally{i.f()}}return e},qn=function(e,t){return Pn(e,Sn(t))},Dn=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var o;return(0,a.Z)(this,n),(o=t.call(this,e,r)).relayer=e,o.logger=r,o.subscriptions=new Map,o.topicMap=new En,o.events=new l.EventEmitter,o.name="subscription",o.version="0.3",o.pending=new Map,o.cached=[],o.initialized=!1,o.pendingSubscriptionWatchLabel="pending_sub_watch_label",o.pollingInterval=20,o.storagePrefix=jt,o.subscribeTimeout=1e4,o.restartInProgress=!1,o.batchSubscribeTopicsLimit=500,o.init=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=o.initialized,e.t0){e.next=10;break}return o.logger.trace("Initialized"),e.next=5,o.restart();case 5:return o.registerEventListeners(),o.onEnable(),e.next=9,o.relayer.core.crypto.getClientId();case 9:o.clientId=e.sent;case 10:case"end":return e.stop()}}),e)}))),o.subscribe=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.restartToComplete();case 2:return o.isInitialized(),o.logger.debug("Subscribing Topic"),o.logger.trace({type:"method",method:"subscribe",params:{topic:t,opts:n}}),e.prev=5,r=(0,f._H)(n),s={topic:t,relay:r},o.pending.set(t,s),e.next=10,o.rpcSubscribe(t,r);case 10:return a=e.sent,e.abrupt("return",(o.onSubscribe(a,s),o.logger.debug("Successfully Subscribed Topic"),o.logger.trace({type:"method",method:"subscribe",params:{topic:t,opts:n}}),a));case 14:throw e.prev=14,e.t0=e.catch(5),o.logger.debug("Failed to Subscribe Topic"),o.logger.error(e.t0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t,n){return e.apply(this,arguments)}}(),o.unsubscribe=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.restartToComplete();case 2:if(o.isInitialized(),!(typeof(null===n||void 0===n?void 0:n.id)<"u")){e.next=8;break}return e.next=6,o.unsubscribeById(t,n.id,n);case 6:e.next=10;break;case 8:return e.next=10,o.unsubscribeByTopic(t,n);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),o.isSubscribed=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.topics.includes(t)){e.next=4;break}e.t0=!0,e.next=7;break;case 4:return e.next=6,new Promise((function(e,n){var r=new M.Watch;r.start(o.pendingSubscriptionWatchLabel);var i=setInterval((function(){!o.pending.has(t)&&o.topics.includes(t)&&(clearInterval(i),r.stop(o.pendingSubscriptionWatchLabel),e(!0)),r.elapsed(o.pendingSubscriptionWatchLabel)>=pn&&(clearInterval(i),r.stop(o.pendingSubscriptionWatchLabel),n(!1))}),o.pollingInterval)}));case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.on=function(e,t){o.events.on(e,t)},o.once=function(e,t){o.events.once(e,t)},o.off=function(e,t){o.events.off(e,t)},o.removeListener=function(e,t){o.events.removeListener(e,t)},o.restart=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.restartInProgress=!0,e.next=3,o.restore();case 3:return e.next=5,o.reset();case 5:o.restartInProgress=!1;case 6:case"end":return e.stop()}}),e)}))),o.relayer=e,o.logger=(0,Z.generateChildLogger)(r,o.name),o.clientId="",o}return(0,o.Z)(n,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.subscriptions.size}},{key:"ids",get:function(){return Array.from(this.subscriptions.keys())}},{key:"values",get:function(){return Array.from(this.subscriptions.values())}},{key:"topics",get:function(){return this.topicMap.topics}},{key:"hasSubscription",value:function(e,t){var n=!1;try{n=this.getSubscription(e).topic===t}catch(r){}return n}},{key:"onEnable",value:function(){this.cached=[],this.initialized=!0}},{key:"onDisable",value:function(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}},{key:"unsubscribeByTopic",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r,a=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.topicMap.get(t),e.next=3,Promise.all(r.map(function(){var e=(0,s.Z)((0,i.Z)().mark((function e(r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.unsubscribeById(t,r,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"unsubscribeById",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,r){var s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:n,opts:r}}),e.prev=1,s=(0,f._H)(r),e.next=5,this.rpcUnsubscribe(t,n,s);case 5:return a=(0,f.D6)("USER_DISCONNECTED","".concat(this.name,", ").concat(t)),e.next=8,this.onUnsubscribe(t,n,a);case 8:this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:n,opts:r}}),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"rpcSubscribe",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:(0,f.cO)(n.protocol).subscribe,params:{topic:t}},this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),e.prev=2,e.next=5,(0,f.hF)(this.relayer.request(r),this.subscribeTimeout);case 5:return e.next=7,e.sent;case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Qt);case 12:return e.abrupt("return",(0,f.rj)(t+this.clientId));case 13:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"rpcBatchSubscribe",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return n=t[0].relay,r={method:(0,f.cO)(n.protocol).batchSubscribe,params:{topics:t.map((function(e){return e.topic}))}},this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),e.prev=4,e.next=7,(0,f.hF)(this.relayer.request(r),this.subscribeTimeout);case 7:return e.next=9,e.sent;case 9:return e.abrupt("return",e.sent);case 12:e.prev=12,e.t0=e.catch(4),this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Qt);case 15:case"end":return e.stop()}}),e,this,[[4,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"rpcUnsubscribe",value:function(e,t,n){var r={method:(0,f.cO)(n.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.request(r)}},{key:"onSubscribe",value:function(e,t){this.setSubscription(e,qn(On({},t),{id:e})),this.pending.delete(t.topic)}},{key:"onBatchSubscribe",value:function(e){var t=this;e.length&&e.forEach((function(e){t.setSubscription(e.id,On({},e)),t.pending.delete(e.topic)}))}},{key:"onUnsubscribe",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.events.removeAllListeners(n),this.hasSubscription(n,t)&&this.deleteSubscription(n,r),e.next=4,this.relayer.messages.del(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setRelayerSubscriptions",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relayer.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelayerSubscriptions",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relayer.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setSubscription",value:function(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}},{key:"addSubscription",value:function(e,t){this.subscriptions.set(e,On({},t)),this.topicMap.set(t.topic,e),this.events.emit(an,t)}},{key:"getSubscription",value:function(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});var t=this.subscriptions.get(e);if(!t){var n=(0,f.Z7)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw new Error(n)}return t}},{key:"deleteSubscription",value:function(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});var n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(on,qn(On({},n),{reason:t}))}},{key:"persist",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRelayerSubscriptions(this.values);case 2:this.events.emit(cn);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reset",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t,n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cached.length){e.next=2;break}return e.abrupt("return");case 2:t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit),n=0;case 4:if(!(n<t)){e.next=11;break}return r=this.cached.splice(0,this.batchSubscribeTopicsLimit),e.next=8,this.batchSubscribe(r);case 8:n++,e.next=4;break;case 11:this.events.emit(un);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"restore",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t,n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getRelayerSubscriptions();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.subscriptions.size){e.next=9;break}throw n=(0,f.Z7)("RESTORE_WILL_OVERRIDE",this.name),r=n.message,this.logger.error(r),this.logger.error("".concat(this.name,": ").concat(JSON.stringify(this.values))),new Error(r);case 9:this.cached=t,this.logger.debug("Successfully Restored subscriptions for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",subscriptions:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore subscriptions for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"batchSubscribe",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.rpcBatchSubscribe(t);case 4:n=e.sent,(0,f.qt)(n)&&this.onBatchSubscribe(n.map((function(e,n){return qn(On({},t[n]),{id:e})})));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onConnect",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.restartInProgress,e.t0){e.next=5;break}return e.next=4,this.restart();case 4:this.onEnable();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onDisconnect",value:function(){this.onDisable()}},{key:"checkPending",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.relayer.transportExplicitlyClosed){e.next=2;break}return e.abrupt("return");case 2:return t=[],this.pending.forEach((function(e){t.push(e)})),e.next=6,this.batchSubscribe(t);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"registerEventListeners",value:function(){var e=this;this.relayer.core.heartbeat.on(b.HEARTBEAT_EVENTS.pulse,(0,s.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkPending();case 2:case"end":return t.stop()}}),t)})))),this.relayer.on(Yt,(0,s.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onConnect();case 2:case"end":return t.stop()}}),t)})))),this.relayer.on(Ft,(function(){e.onDisconnect()})),this.events.on(an,function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){var r;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=an,e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:n}),t.next=5,e.persist();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.events.on(on,function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){var r;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=on,e.logger.info("Emitting ".concat(r)),e.logger.debug({type:"event",event:r,data:n}),t.next=5,e.persist();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,f.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"restartToComplete",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.restartInProgress,!e.t0){e.next=4;break}return e.next=4,new Promise((function(e){var n=setInterval((function(){t.restartInProgress||(clearInterval(n),e())}),t.pollingInterval)}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(C),An=Object.defineProperty,Tn=Object.getOwnPropertySymbols,Mn=Object.prototype.hasOwnProperty,zn=Object.prototype.propertyIsEnumerable,Ln=function(e,t,n){return t in e?An(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},jn=function(e,t){for(var n in t||(t={}))Mn.call(t,n)&&Ln(e,n,t[n]);if(Tn){var r,i=(0,p.Z)(Tn(t));try{for(i.s();!(r=i.n()).done;){n=r.value;zn.call(t,n)&&Ln(e,n,t[n])}}catch(s){i.e(s)}finally{i.f()}}return e},Un=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e)).protocol="wc",r.version=2,r.events=new l.EventEmitter,r.name="relayer",r.transportExplicitlyClosed=!1,r.initialized=!1,r.reconnecting=!1,r.connectionStatusPollingInterval=20,r.staleConnectionErrors=["socket hang up","socket stalled"],r.request=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.logger.debug("Publishing Request Payload"),e.prev=1,e.next=4,r.toEstablishConnection();case 4:return e.next=6,r.provider.request(t);case 6:return e.abrupt("return",e.sent);case 9:throw e.prev=9,e.t0=e.catch(1),r.logger.debug("Failed to Publish Request"),r.logger.error(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),r.core=e.core,r.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?(0,Z.generateChildLogger)(e.logger,r.name):v()((0,Z.getDefaultLoggerOptions)({level:e.logger||"error"})),r.messages=new Zn(r.logger,e.core),r.subscriber=new Dn((0,g.Z)(r),r.logger),r.publisher=new kn((0,g.Z)(r),r.logger),r.relayUrl=(null===e||void 0===e?void 0:e.relayUrl)||Jt,r.projectId=e.projectId,r.provider={},r}return(0,o.Z)(n,[{key:"init",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.next=3,this.createProvider();case 3:return e.next=5,Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]);case 5:this.registerEventListeners(),this.initialized=!0;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"connected",get:function(){return this.provider.connection.connected}},{key:"connecting",get:function(){return this.provider.connection.connecting}},{key:"publish",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitialized(),e.next=3,this.publisher.publish(t,n,r);case 3:return e.next=5,this.recordMessageEvent({topic:t,message:n,publishedAt:Date.now()});case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"subscribe",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r,a=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitialized(),r="",e.next=4,Promise.all([new Promise((function(e){a.subscriber.once(an,(function(n){n.topic===t&&e()}))})),new Promise(function(){var e=(0,s.Z)((0,i.Z)().mark((function e(s){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.subscriber.subscribe(t,n);case 2:r=e.sent,s();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())]);case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isInitialized(),e.next=3,this.subscriber.unsubscribe(t,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"removeListener",value:function(e,t){this.events.removeListener(e,t)}},{key:"transportClose",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.transportExplicitlyClosed=!0,e.t0=this.connected,!e.t0){e.next=6;break}return e.next=5,this.provider.disconnect();case 5:this.events.emit(Xt);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"transportOpen",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reconnecting){e.next=23;break}return this.relayUrl=t||this.relayUrl,this.transportExplicitlyClosed=!1,this.reconnecting=!0,e.prev=2,e.t0=Promise,e.t1=new Promise((function(e){r.initialized||e(),r.subscriber.once(un,(function(){e()}))})),e.next=7,Promise.race([new Promise(function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.hF)(r.provider.connect(),5e3,"socket stalled").catch((function(e){return n(e)})).then((function(){return t()})).finally((function(){return r.removeListener(Xt,r.rejectTransportOpen)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),new Promise((function(e){return r.once(Xt,r.rejectTransportOpen)}))]);case 7:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=11,e.t0.all.call(e.t0,e.t3);case 11:e.next=20;break;case 13:if(e.prev=13,e.t4=e.catch(2),this.logger.error(e.t4),n=e.t4,this.isConnectionStalled(n.message)){e.next=19;break}throw e.t4;case 19:this.events.emit(Xt);case 20:return e.prev=20,this.reconnecting=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[2,13,20,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"restartTransport",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.transportExplicitlyClosed,e.t0){e.next=11;break}return this.relayUrl=t||this.relayUrl,e.next=5,this.transportClose();case 5:return e.next=7,new Promise((function(e){return setTimeout(e,500)}));case 7:return e.next=9,this.createProvider();case 9:return e.next=11,this.transportOpen();case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isConnectionStalled",value:function(e){return this.staleConnectionErrors.some((function(t){return e.includes(t)}))}},{key:"rejectTransportOpen",value:function(){throw new Error("closeTransport called before connection was established")}},{key:"createProvider",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.crypto.signJWT(this.relayUrl);case 2:t=e.sent,this.provider=new z.r(new se((0,f.$0)({sdkVersion:"2.6.2",protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0}))),this.registerProviderListeners();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"recordMessageEvent",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.topic,r=t.message,e.next=3,this.messages.set(n,r);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"shouldIgnoreMessageEvent",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.topic,r=t.message,e.next=3,this.subscriber.isSubscribed(n);case 3:if(!e.sent){e.next=7;break}e.t0=this.messages.has(n,r),e.next=8;break;case 7:e.t0=!0;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onProviderPayload",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r,s,a,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),!X(t)){e.next=11;break}if(t.method.endsWith("_subscription")){e.next=3;break}return e.abrupt("return");case 3:return n=t.params,r=n.data,s=r.topic,a=r.message,o=r.publishedAt,c={topic:s,message:a,publishedAt:o},this.logger.debug("Emitting Relayer Payload"),this.logger.trace(jn({type:"event",event:n.id},c)),this.events.emit(n.id,c),e.next=9,this.acknowledgePayload(t);case 9:return e.next=11,this.onMessageEvent(c);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onMessageEvent",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.shouldIgnoreMessageEvent(t);case 2:if(e.t0=e.sent,e.t0){e.next=7;break}return this.events.emit(Bt,t),e.next=7,this.recordMessageEvent(t);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"acknowledgePayload",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=F(t.id,!0),e.next=3,this.provider.connection.send(n);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"registerProviderListeners",value:function(){var e=this;this.provider.on(en,(function(t){return e.onProviderPayload(t)})),this.provider.on(tn,(function(){e.events.emit(Yt)})),this.provider.on(nn,(function(){e.onProviderDisconnect()})),this.provider.on(rn,(function(t){e.logger.error(t),e.events.emit(Wt,t)}))}},{key:"registerEventListeners",value:function(){var e=this;this.events.on(Qt,(0,s.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.restartTransport();case 2:case"end":return t.stop()}}),t)}))))}},{key:"onProviderDisconnect",value:function(){this.events.emit(Ft),this.attemptToReconnect()}},{key:"attemptToReconnect",value:function(){var e=this;this.transportExplicitlyClosed||setTimeout((0,s.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.restartTransport();case 2:case"end":return t.stop()}}),t)}))),(0,M.toMiliseconds)(sn))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,f.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"toEstablishConnection",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connected){e.next=7;break}if(!this.connecting){e.next=5;break}return e.next=4,new Promise((function(e){var n=setInterval((function(){t.connected&&(clearInterval(n),e())}),t.connectionStatusPollingInterval)}));case 4:return e.abrupt("return",e.sent);case 5:return e.next=7,this.restartTransport();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(_),Vn=Object.defineProperty,Kn=Object.getOwnPropertySymbols,Hn=Object.prototype.hasOwnProperty,Gn=Object.prototype.propertyIsEnumerable,Jn=function(e,t,n){return t in e?Vn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Bn=function(e,t){for(var n in t||(t={}))Hn.call(t,n)&&Jn(e,n,t[n]);if(Kn){var r,i=(0,p.Z)(Kn(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Gn.call(t,n)&&Jn(e,n,t[n])}}catch(s){i.e(s)}finally{i.f()}}return e},Yn=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r,o){var c,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:jt,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return(0,a.Z)(this,n),(c=t.call(this,e,r,o,u)).core=e,c.logger=r,c.name=o,c.map=new Map,c.version="0.3",c.cached=[],c.initialized=!1,c.storagePrefix=jt,c.init=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=c.initialized,e.t0){e.next=8;break}return c.logger.trace("Initialized"),e.next=5,c.restore();case 5:c.cached.forEach((function(e){c.getKey&&null!==e&&!(0,f.o8)(e)?c.map.set(c.getKey(e),e):(0,f.xW)(e)?c.map.set(e.id,e):(0,f.h1)(e)&&c.map.set(e.topic,e)})),c.cached=[],c.initialized=!0;case 8:case"end":return e.stop()}}),e)}))),c.set=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isInitialized(),!c.map.has(t)){e.next=6;break}return e.next=4,c.update(t,n);case 4:e.next=11;break;case 6:return c.logger.debug("Setting value"),c.logger.trace({type:"method",method:"set",key:t,value:n}),c.map.set(t,n),e.next=11,c.persist();case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),c.get=function(e){return c.isInitialized(),c.logger.debug("Getting value"),c.logger.trace({type:"method",method:"get",key:e}),c.getData(e)},c.getAll=function(e){return c.isInitialized(),e?c.values.filter((function(t){return Object.keys(e).every((function(n){return oe()(t[n],e[n])}))})):c.values},c.update=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.isInitialized(),c.logger.debug("Updating value"),c.logger.trace({type:"method",method:"update",key:t,update:n}),r=Bn(Bn({},c.getData(t)),n),c.map.set(t,r),e.next=5,c.persist();case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),c.delete=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isInitialized(),e.t0=c.map.has(t),!e.t0){e.next=8;break}return c.logger.debug("Deleting value"),c.logger.trace({type:"method",method:"delete",key:t,reason:n}),c.map.delete(t),e.next=8,c.persist();case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),c.logger=(0,Z.generateChildLogger)(r,c.name),c.storagePrefix=u,c.getKey=p,c}return(0,o.Z)(n,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.map.size}},{key:"keys",get:function(){return Array.from(this.map.keys())}},{key:"values",get:function(){return Array.from(this.map.values())}},{key:"setDataStore",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDataStore",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getData",value:function(e){var t=this.map.get(e);if(!t){var n=(0,f.Z7)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw this.logger.error(n),new Error(n)}return t}},{key:"persist",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setDataStore(this.values);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"restore",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t,n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getDataStore();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.map.size){e.next=9;break}throw n=(0,f.Z7)("RESTORE_WILL_OVERRIDE",this.name),r=n.message,this.logger.error(r),new Error(r);case 9:this.cached=t,this.logger.debug("Successfully Restored value for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",value:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore value for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,f.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),n}(R),Fn=function(){function e(t,n){var r=this;(0,a.Z)(this,e),this.core=t,this.logger=n,this.name="pairing",this.version="0.3",this.events=new(h()),this.initialized=!1,this.storagePrefix=jt,this.ignoredPayloadTypes=[f.rV],this.registeredMethods=[],this.init=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.initialized,e.t0){e.next=10;break}return e.next=4,r.pairings.init();case 4:return e.next=6,r.cleanup();case 6:r.registerRelayerEvents(),r.registerExpirerEvents(),r.initialized=!0,r.logger.trace("Initialized");case 10:case"end":return e.stop()}}),e)}))),this.register=function(e){var t=e.methods;r.isInitialized(),r.registeredMethods=(0,c.Z)(new Set([].concat((0,c.Z)(r.registeredMethods),(0,c.Z)(t))))},this.create=(0,s.Z)((0,i.Z)().mark((function e(){var t,n,s,a,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),t=(0,f.jd)(),e.next=4,r.core.crypto.setSymKey(t);case 4:return n=e.sent,s=(0,f.gn)(M.FIVE_MINUTES),o={topic:n,expiry:s,relay:a={protocol:"irn"},active:!1},c=(0,f.Bv)({protocol:r.core.protocol,version:r.core.version,topic:n,symKey:t,relay:a}),e.next=11,r.pairings.set(n,o);case 11:return e.next=13,r.core.relayer.subscribe(n);case 13:return r.core.expirer.set(n,s),e.abrupt("return",{topic:n,uri:c});case 15:case"end":return e.stop()}}),e)}))),this.pair=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.isInitialized(),r.isValidPair(t),n=(0,f.he)(t.uri),s=n.topic,a=n.symKey,o=n.relay,!r.pairings.keys.includes(s)){e.next=4;break}throw new Error("Pairing already exists: ".concat(s));case 4:if(!r.core.crypto.hasKeys(s)){e.next=6;break}throw new Error("Keychain already exists: ".concat(s));case 6:return c=(0,f.gn)(M.FIVE_MINUTES),u={topic:s,relay:o,expiry:c,active:!1},e.next=9,r.pairings.set(s,u);case 9:return e.next=11,r.core.crypto.setSymKey(a,s);case 11:return e.next=13,r.core.relayer.subscribe(s,{relay:o});case 13:if(r.core.expirer.set(s,c),e.t0=t.activatePairing,!e.t0){e.next=18;break}return e.next=18,r.activate({topic:s});case 18:return e.abrupt("return",u);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.activate=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.topic,r.isInitialized(),s=(0,f.gn)(M.THIRTY_DAYS),e.next=5,r.pairings.update(n,{active:!0,expiry:s});case 5:r.core.expirer.set(n,s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.ping=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidPing(t);case 3:if(n=t.topic,!r.pairings.keys.includes(n)){e.next=15;break}return e.next=7,r.sendRequest(n,"wc_pairingPing",{});case 7:return s=e.sent,a=(0,f.H1)(),o=a.done,c=a.resolve,u=a.reject,r.events.once((0,f.E0)("pairing_ping",s),(function(e){var t=e.error;t?u(t):c()})),e.next=15,o();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateExpiry=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.topic,s=t.expiry,r.isInitialized(),e.next=4,r.pairings.update(n,{expiry:s});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateMetadata=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.topic,s=t.metadata,r.isInitialized(),e.next=4,r.pairings.update(n,{peerMetadata:s});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getPairings=function(){return r.isInitialized(),r.pairings.values},this.disconnect=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidDisconnect(t);case 3:if(n=t.topic,e.t0=r.pairings.keys.includes(n),!e.t0){e.next=10;break}return e.next=8,r.sendRequest(n,"wc_pairingDelete",(0,f.D6)("USER_DISCONNECTED"));case 8:return e.next=10,r.deletePairing(n);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,s){var a,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Y(n,s),e.next=3,r.core.crypto.encode(t,a);case 3:return o=e.sent,c=ln[n].req,r.core.history.set(t,a),e.next=8,r.core.relayer.publish(t,o,c);case 8:return e.abrupt("return",a.id);case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.sendResult=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,s){var a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=F(t,s),e.next=3,r.core.crypto.encode(n,a);case 3:return o=e.sent,e.next=6,r.core.history.get(n,t);case 6:return c=e.sent,u=ln[c.request.method].res,e.next=10,r.core.relayer.publish(n,o,u);case 10:return e.next=12,r.core.history.resolve(a);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.sendError=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,s){var a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={id:t,jsonrpc:"2.0",error:W(s,void 0)},e.next=3,r.core.crypto.encode(n,a);case 3:return o=e.sent,e.next=6,r.core.history.get(n,t);case 6:return c=e.sent,u=ln[c.request.method]?ln[c.request.method].res:ln.unregistered_method.res,e.next=10,r.core.relayer.publish(n,o,u);case 10:return e.next=12,r.core.history.resolve(a);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.deletePairing=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.core.relayer.unsubscribe(t);case 2:return e.next=4,Promise.all([r.pairings.delete(t,(0,f.D6)("USER_DISCONNECTED")),r.core.crypto.deleteSymKey(t),n?Promise.resolve():r.core.expirer.del(t)]);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.cleanup=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.pairings.getAll().filter((function(e){return(0,f.Bw)(e.expiry)})),e.next=3,Promise.all(t.map((function(e){return r.deletePairing(e.topic)})));case 3:case"end":return e.stop()}}),e)}))),this.onRelayEventRequest=function(e){var t=e.topic,n=e.payload,i=n.method;if(r.pairings.keys.includes(t))switch(i){case"wc_pairingPing":return r.onPairingPingRequest(t,n);case"wc_pairingDelete":return r.onPairingDeleteRequest(t,n);default:return r.onUnknownRpcMethodRequest(t,n)}},this.onRelayEventResponse=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.topic,s=t.payload,e.next=4,r.core.history.get(n,s.id);case 4:if(a=e.sent.request.method,!r.pairings.keys.includes(n)){e.next=11;break}e.t0=a,e.next="wc_pairingPing"===e.t0?9:10;break;case 9:return e.abrupt("return",r.onPairingPingResponse(n,s));case 10:return e.abrupt("return",r.onUnknownRpcMethodResponse(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onPairingPingRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.id,e.prev=1,r.isValidPing({topic:t}),e.next=5,r.sendResult(s,t,!0);case 5:r.events.emit("pairing_ping",{id:s,topic:t}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,r.sendError(s,t,e.t0);case 12:r.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}(),this.onPairingPingResponse=function(e,t){var n=t.id;setTimeout((function(){$(t)?r.events.emit((0,f.E0)("pairing_ping",n),{}):ee(t)&&r.events.emit((0,f.E0)("pairing_ping",n),{error:t.error})}),500)},this.onPairingDeleteRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.id,e.prev=1,r.isValidDisconnect({topic:t}),e.next=5,r.deletePairing(t);case 5:r.events.emit("pairing_delete",{id:s,topic:t}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,r.sendError(s,t,e.t0);case 12:r.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}(),this.onUnknownRpcMethodRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.id,a=n.method,e.prev=1,!r.registeredMethods.includes(a)){e.next=4;break}return e.abrupt("return");case 4:return o=(0,f.D6)("WC_METHOD_UNSUPPORTED",a),e.next=7,r.sendError(s,t,o);case 7:r.logger.error(o),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,r.sendError(s,t,e.t0);case 14:r.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,n){return e.apply(this,arguments)}}(),this.onUnknownRpcMethodResponse=function(e){r.registeredMethods.includes(e)||r.logger.error((0,f.D6)("WC_METHOD_UNSUPPORTED",e))},this.isValidPair=function(e){if(!(0,f.EJ)(e)){var t=(0,f.Z7)("MISSING_OR_INVALID","pair() params: ".concat(e)).message;throw new Error(t)}if(!(0,f.jv)(e.uri)){var n=(0,f.Z7)("MISSING_OR_INVALID","pair() uri: ".concat(e.uri)).message;throw new Error(n)}},this.isValidPing=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","ping() params: ".concat(t)),s=n.message,new Error(s);case 3:return a=t.topic,e.next=6,r.isValidPairingTopic(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isValidDisconnect=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","disconnect() params: ".concat(t)),s=n.message,new Error(s);case 3:return a=t.topic,e.next=6,r.isValidPairingTopic(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.isValidPairingTopic=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.M_)(t,!1)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","pairing topic should be a string: ".concat(t)),s=n.message,new Error(s);case 3:if(r.pairings.keys.includes(t)){e.next=6;break}throw a=(0,f.Z7)("NO_MATCHING_KEY","pairing topic doesn't exist: ".concat(t)),o=a.message,new Error(o);case 6:if(!(0,f.Bw)(r.pairings.get(t).expiry)){e.next=11;break}return e.next=9,r.deletePairing(t);case 9:throw c=(0,f.Z7)("EXPIRED","pairing topic: ".concat(t)),u=c.message,new Error(u);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.core=t,this.logger=(0,Z.generateChildLogger)(n,this.name),this.pairings=new Yn(this.core,this.logger,this.name,this.storagePrefix)}return(0,o.Z)(e,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,f.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"registerRelayerEvents",value:function(){var e=this;this.core.relayer.on(Bt,function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){var r,s,a;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.topic,s=n.message,!e.ignoredPayloadTypes.includes(e.core.crypto.getPayloadType(s))){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.core.crypto.decode(r,s);case 5:if(!X(a=t.sent)){t.next=10;break}e.core.history.set(r,a),e.onRelayEventRequest({topic:r,payload:a}),t.next=15;break;case 10:if(t.t0=Q(i=a)&&($(i)||ee(i)),!t.t0){t.next=15;break}return t.next=14,e.core.history.resolve(a);case 14:e.onRelayEventResponse({topic:r,payload:a});case 15:case"end":return t.stop()}var i}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerExpirerEvents",value:function(){var e=this;this.core.expirer.on(yn,function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){var r,s;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(0,f.iP)(n.target),s=r.topic,t.t0=s&&e.pairings.keys.includes(s),!t.t0){t.next=6;break}return t.next=5,e.deletePairing(s,!0);case 5:e.events.emit("pairing_expire",{topic:s});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),e}(),Wn=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var o;return(0,a.Z)(this,n),(o=t.call(this,e,r)).core=e,o.logger=r,o.records=new Map,o.events=new l.EventEmitter,o.name="history",o.version="0.3",o.cached=[],o.initialized=!1,o.storagePrefix=jt,o.init=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=o.initialized,e.t0){e.next=9;break}return o.logger.trace("Initialized"),e.next=5,o.restore();case 5:o.cached.forEach((function(e){return o.records.set(e.id,e)})),o.cached=[],o.registerEventListeners(),o.initialized=!0;case 9:case"end":return e.stop()}}),e)}))),o.set=function(e,t,n){if(o.isInitialized(),o.logger.debug("Setting JSON-RPC request history record"),o.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:n}),!o.records.has(t.id)){var r={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:n};o.records.set(r.id,r),o.events.emit(hn,r)}},o.resolve=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.isInitialized(),o.logger.debug("Updating JSON-RPC response history record"),o.logger.trace({type:"method",method:"update",response:t}),o.records.has(t.id)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,o.getRecord(t.id);case 4:typeof(n=e.sent).response>"u"&&(n.response=ee(t)?{error:t.error}:{result:t.result},o.records.set(n.id,n),o.events.emit(fn,n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.get=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.isInitialized(),o.logger.debug("Getting record"),o.logger.trace({type:"method",method:"get",topic:t,id:n}),e.next=5,o.getRecord(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),o.delete=function(e,t){o.isInitialized(),o.logger.debug("Deleting record"),o.logger.trace({type:"method",method:"delete",id:t}),o.values.forEach((function(n){if(n.topic===e){if(typeof t<"u"&&n.id!==t)return;o.records.delete(n.id),o.events.emit(dn,n)}}))},o.exists=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.isInitialized(),!o.records.has(n)){e.next=9;break}return e.next=4,o.getRecord(n);case 4:e.t1=e.sent.topic,e.t2=t,e.t0=e.t1===e.t2,e.next=10;break;case 9:e.t0=!1;case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),o.on=function(e,t){o.events.on(e,t)},o.once=function(e,t){o.events.once(e,t)},o.off=function(e,t){o.events.off(e,t)},o.removeListener=function(e,t){o.events.removeListener(e,t)},o.logger=(0,Z.generateChildLogger)(r,o.name),o}return(0,o.Z)(n,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"size",get:function(){return this.records.size}},{key:"keys",get:function(){return Array.from(this.records.keys())}},{key:"values",get:function(){return Array.from(this.records.values())}},{key:"pending",get:function(){var e=[];return this.values.forEach((function(t){if(!(typeof t.response<"u")){var n={topic:t.topic,request:Y(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(n)}})),e}},{key:"setJsonRpcRecords",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getJsonRpcRecords",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRecord",value:function(e){this.isInitialized();var t=this.records.get(e);if(!t){var n=(0,f.Z7)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw new Error(n)}return t}},{key:"persist",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setJsonRpcRecords(this.values);case 2:this.events.emit(vn);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"restore",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t,n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getJsonRpcRecords();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.records.size){e.next=9;break}throw n=(0,f.Z7)("RESTORE_WILL_OVERRIDE",this.name),r=n.message,this.logger.error(r),new Error(r);case 9:this.cached=t,this.logger.debug("Successfully Restored records for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",records:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore records for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"registerEventListeners",value:function(){var e=this;this.events.on(hn,(function(t){var n=hn;e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,record:t}),e.persist()})),this.events.on(fn,(function(t){var n=fn;e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,record:t}),e.persist()})),this.events.on(dn,(function(t){var n=dn;e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,record:t}),e.persist()}))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,f.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),n}(I),Qn=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var o;return(0,a.Z)(this,n),(o=t.call(this,e,r)).core=e,o.logger=r,o.expirations=new Map,o.events=new l.EventEmitter,o.name="expirer",o.version="0.3",o.cached=[],o.initialized=!1,o.storagePrefix=jt,o.init=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=o.initialized,e.t0){e.next=9;break}return o.logger.trace("Initialized"),e.next=5,o.restore();case 5:o.cached.forEach((function(e){return o.expirations.set(e.target,e)})),o.cached=[],o.registerEventListeners(),o.initialized=!0;case 9:case"end":return e.stop()}}),e)}))),o.has=function(e){try{var t=o.formatTarget(e);return typeof o.getExpiration(t)<"u"}catch(n){return!1}},o.set=function(e,t){o.isInitialized();var n=o.formatTarget(e),r={target:n,expiry:t};o.expirations.set(n,r),o.checkExpiry(n,r),o.events.emit(gn,{target:n,expiration:r})},o.get=function(e){o.isInitialized();var t=o.formatTarget(e);return o.getExpiration(t)},o.del=function(e){if(o.isInitialized(),o.has(e)){var t=o.formatTarget(e),n=o.getExpiration(t);o.expirations.delete(t),o.events.emit(mn,{target:t,expiration:n})}},o.on=function(e,t){o.events.on(e,t)},o.once=function(e,t){o.events.once(e,t)},o.off=function(e,t){o.events.off(e,t)},o.removeListener=function(e,t){o.events.removeListener(e,t)},o.logger=(0,Z.generateChildLogger)(r,o.name),o}return(0,o.Z)(n,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"storageKey",get:function(){return this.storagePrefix+this.version+"//"+this.name}},{key:"length",get:function(){return this.expirations.size}},{key:"keys",get:function(){return Array.from(this.expirations.keys())}},{key:"values",get:function(){return Array.from(this.expirations.values())}},{key:"formatTarget",value:function(e){if("string"==typeof e)return(0,f.Z4)(e);if("number"==typeof e)return(0,f.Gq)(e);var t=(0,f.Z7)("UNKNOWN_TYPE","Target type: ".concat(typeof e)).message;throw new Error(t)}},{key:"setExpirations",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.setItem(this.storageKey,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getExpirations",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.storage.getItem(this.storageKey);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"persist",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setExpirations(this.values);case 2:this.events.emit(wn);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"restore",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t,n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getExpirations();case 3:if(!(typeof(t=e.sent)>"u")&&t.length){e.next=6;break}return e.abrupt("return");case 6:if(!this.expirations.size){e.next=9;break}throw n=(0,f.Z7)("RESTORE_WILL_OVERRIDE",this.name),r=n.message,this.logger.error(r),new Error(r);case 9:this.cached=t,this.logger.debug("Successfully Restored expirations for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",expirations:this.values}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.logger.debug("Failed to Restore expirations for ".concat(this.name)),this.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"getExpiration",value:function(e){var t=this.expirations.get(e);if(!t){var n=(0,f.Z7)("NO_MATCHING_KEY","".concat(this.name,": ").concat(e)).message;throw this.logger.error(n),new Error(n)}return t}},{key:"checkExpiry",value:function(e,t){var n=t.expiry;(0,M.toMiliseconds)(n)-Date.now()<=0&&this.expire(e,t)}},{key:"expire",value:function(e,t){this.expirations.delete(e),this.events.emit(yn,{target:e,expiration:t})}},{key:"checkExpirations",value:function(){var e=this;this.core.relayer.connected&&this.expirations.forEach((function(t,n){return e.checkExpiry(n,t)}))}},{key:"registerEventListeners",value:function(){var e=this;this.core.heartbeat.on(b.HEARTBEAT_EVENTS.pulse,(function(){return e.checkExpirations()})),this.events.on(gn,(function(t){var n=gn;e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,data:t}),e.persist()})),this.events.on(yn,(function(t){var n=yn;e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,data:t}),e.persist()})),this.events.on(mn,(function(t){var n=mn;e.logger.info("Emitting ".concat(n)),e.logger.debug({type:"event",event:n,data:t}),e.persist()}))}},{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,f.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}}]),n}(N),Xn=Object.defineProperty,$n=Object.getOwnPropertySymbols,er=Object.prototype.hasOwnProperty,tr=Object.prototype.propertyIsEnumerable,nr=function(e,t,n){return t in e?Xn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},rr=function(e,t){for(var n in t||(t={}))er.call(t,n)&&nr(e,n,t[n]);if($n){var r,i=(0,p.Z)($n(t));try{for(i.s();!(r=i.n()).done;){n=r.value;tr.call(t,n)&&nr(e,n,t[n])}}catch(s){i.e(s)}finally{i.f()}}return e},ir=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;(0,a.Z)(this,n),(r=t.call(this,e)).protocol="wc",r.version=2,r.name=Lt,r.events=new l.EventEmitter,r.initialized=!1,r.on=function(e,t){return r.events.on(e,t)},r.once=function(e,t){return r.events.once(e,t)},r.off=function(e,t){return r.events.off(e,t)},r.removeListener=function(e,t){return r.events.removeListener(e,t)},r.projectId=null===e||void 0===e?void 0:e.projectId,r.relayUrl=(null===e||void 0===e?void 0:e.relayUrl)||Jt;var i=typeof(null===e||void 0===e?void 0:e.logger)<"u"&&"string"!=typeof(null===e||void 0===e?void 0:e.logger)?e.logger:v()((0,Z.getDefaultLoggerOptions)({level:(null===e||void 0===e?void 0:e.logger)||Ut}));return r.logger=(0,Z.generateChildLogger)(i,r.name),r.heartbeat=new b.HeartBeat,r.crypto=new bn((0,g.Z)(r),r.logger,null===e||void 0===e?void 0:e.keychain),r.history=new Wn((0,g.Z)(r),r.logger),r.expirer=new Qn((0,g.Z)(r),r.logger),r.storage=null!=e&&e.storage?e.storage:new x.ZP(rr(rr({},Vt),null===e||void 0===e?void 0:e.storageOptions)),r.relayer=new Un({core:(0,g.Z)(r),logger:r.logger,relayUrl:r.relayUrl,projectId:r.projectId}),r.pairing=new Fn((0,g.Z)(r),r.logger),r}return(0,o.Z)(n,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"start",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.initialized,e.t0){e.next=4;break}return e.next=4,this.initialize();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initialize",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.prev=1,e.next=4,this.crypto.init();case 4:return e.next=6,this.history.init();case 6:return e.next=8,this.expirer.init();case 8:return e.next=10,this.relayer.init();case 10:return e.next=12,this.heartbeat.init();case 12:return e.next=14,this.pairing.init();case 14:this.initialized=!0,this.logger.info("Core Initialization Success"),e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(1),this.logger.warn("Core Initialization Failure at epoch ".concat(Date.now()),e.t0),this.logger.error(e.t0.message),e.t0;case 21:case"end":return e.stop()}}),e,this,[[1,18]])})));return function(){return e.apply(this,arguments)}}()}],[{key:"init",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new n(t),e.next=3,r.initialize();case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(E),sr=ir,ar=(k.q,k.q,k.q,k.q,k.q,k.q,h(),(0,o.Z)((function e(t){(0,a.Z)(this,e),this.opts=t,this.protocol="wc",this.version=2}))),or=(l.EventEmitter,(0,o.Z)((function e(t){(0,a.Z)(this,e),this.client=t}))),cr="INTERNAL_ERROR",ur="SERVER_ERROR",pr=[-32700,-32600,-32601,-32602,-32603],lr=(zt={},(0,u.Z)(zt,"PARSE_ERROR",{code:-32700,message:"Parse error"}),(0,u.Z)(zt,"INVALID_REQUEST",{code:-32600,message:"Invalid Request"}),(0,u.Z)(zt,"METHOD_NOT_FOUND",{code:-32601,message:"Method not found"}),(0,u.Z)(zt,"INVALID_PARAMS",{code:-32602,message:"Invalid params"}),(0,u.Z)(zt,cr,{code:-32603,message:"Internal error"}),(0,u.Z)(zt,ur,{code:-32e3,message:"Server error"}),zt),hr=ur;function fr(e){return pr.includes(e)}function dr(e){return Object.keys(lr).includes(e)?lr[e]:lr[hr]}function vr(e){var t=Object.values(lr).find((function(t){return t.code===e}));return t||lr[hr]}function gr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return Date.now()*Math.pow(10,e)+Math.floor(Math.random()*Math.pow(10,e))}function mr(e,t){return"undefined"===typeof e?dr(cr):("string"===typeof e&&(e=Object.assign(Object.assign({},dr(ur)),{message:e})),"undefined"!==typeof t&&(e.data=t),fr(e.code)&&(e=vr(e.code)),e)}function yr(e){return"object"===typeof e&&"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function wr(e){return yr(e)&&(xr(e)||br(e))}function xr(e){return"result"in e}function br(e){return"error"in e}var Zr="client",kr="".concat("wc","@").concat(2,":").concat(Zr,":"),Er=Zr,Ir="error",Pr=(M.THIRTY_DAYS,"Proposal expired"),Sr=M.SEVEN_DAYS,_r={wc_sessionPropose:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1104},res:{ttl:M.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1106},res:{ttl:M.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1112},res:{ttl:M.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1115}}},Rr={min:M.FIVE_MINUTES,max:M.SEVEN_DAYS},Cr=Object.defineProperty,Nr=Object.defineProperties,Or=Object.getOwnPropertyDescriptors,qr=Object.getOwnPropertySymbols,Dr=Object.prototype.hasOwnProperty,Ar=Object.prototype.propertyIsEnumerable,Tr=function(e,t,n){return t in e?Cr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Mr=function(e,t){for(var n in t||(t={}))Dr.call(t,n)&&Tr(e,n,t[n]);if(qr){var r,i=(0,p.Z)(qr(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Ar.call(t,n)&&Tr(e,n,t[n])}}catch(s){i.e(s)}finally{i.f()}}return e},zr=function(e,t){return Nr(e,Or(t))},Lr=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e)).name="engine",r.events=new(h()),r.initialized=!1,r.ignoredPayloadTypes=[f.rV],r.init=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.initialized,e.t0){e.next=8;break}return e.next=4,r.cleanup();case 4:r.registerRelayerEvents(),r.registerExpirerEvents(),r.client.core.pairing.register({methods:Object.keys(_r)}),r.initialized=!0;case 8:case"end":return e.stop()}}),e)}))),r.connect=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,a,o,c,u,p,l,h,d,v,g,m,y,w,x,b,Z,k,E,I,P,S;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),n=zr(Mr({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}}),e.next=4,r.isValidConnect(n);case 4:if(a=n.pairingTopic,o=n.requiredNamespaces,c=n.optionalNamespaces,u=n.sessionProperties,p=n.relays,d=!1,(l=a)&&(d=r.client.core.pairing.pairings.get(l).active),l&&d){e.next=13;break}return e.next=9,r.client.core.pairing.create();case 9:v=e.sent,g=v.topic,m=v.uri,l=g,h=m;case 13:return e.next=15,r.client.core.crypto.generateKeyPair();case 15:if(y=e.sent,w=Mr({requiredNamespaces:o,optionalNamespaces:c,relays:null!==p&&void 0!==p?p:[{protocol:"irn"}],proposer:{publicKey:y,metadata:r.client.metadata}},u&&{sessionProperties:u}),x=(0,f.H1)(M.FIVE_MINUTES,Pr),b=x.reject,Z=x.resolve,k=x.done,r.events.once((0,f.E0)("session_connect"),function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.error,s=t.session,!n){e.next=5;break}b(n),e.next=17;break;case 5:if(!s){e.next=17;break}return s.self.publicKey=y,a=zr(Mr({},s),{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces}),e.next=10,r.client.session.set(s.topic,a);case 10:return e.next=12,r.setExpiry(s.topic,s.expiry);case 12:if(e.t0=l,!e.t0){e.next=16;break}return e.next=16,r.client.core.pairing.updateMetadata({topic:l,metadata:s.peer.metadata});case 16:Z(a);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l){e.next=24;break}throw E=(0,f.Z7)("NO_MATCHING_KEY","connect() pairing topic: ".concat(l)),I=E.message,new Error(I);case 24:return e.next=26,r.sendRequest(l,"wc_sessionPropose",w);case 26:return P=e.sent,S=(0,f.gn)(M.FIVE_MINUTES),e.next=30,r.setProposal(P,Mr({id:P,expiry:S},w));case 30:return e.abrupt("return",{uri:h,approval:k});case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.pair=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.client.core.pairing.pair(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.approve=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u,p,l,h,d,v,g,m,y;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidApprove(t);case 3:return n=t.id,s=t.relayProtocol,a=t.namespaces,o=t.sessionProperties,c=r.client.proposal.get(n),u=c.pairingTopic,p=c.proposer,l=c.requiredNamespaces,h=c.optionalNamespaces,u=u||"",(0,f.L5)(l)||(l=(0,f.fc)(a,"approve()")),e.next=8,r.client.core.crypto.generateKeyPair();case 8:return d=e.sent,v=p.publicKey,e.next=12,r.client.core.crypto.generateSharedKey(d,v);case 12:if(g=e.sent,e.t0=u&&n,!e.t0){e.next=23;break}return e.next=17,r.client.core.pairing.updateMetadata({topic:u,metadata:p.metadata});case 17:return e.next=19,r.sendResult(n,u,{relay:{protocol:null!==s&&void 0!==s?s:"irn"},responderPublicKey:d});case 19:return e.next=21,r.client.proposal.delete(n,(0,f.D6)("USER_DISCONNECTED"));case 21:return e.next=23,r.client.core.pairing.activate({topic:u});case 23:return m=Mr({relay:{protocol:null!==s&&void 0!==s?s:"irn"},namespaces:a,requiredNamespaces:l,optionalNamespaces:h,pairingTopic:u,controller:{publicKey:d,metadata:r.client.metadata},expiry:(0,f.gn)(Sr)},o&&{sessionProperties:o}),e.next=26,r.client.core.relayer.subscribe(g);case 26:return e.next=28,r.sendRequest(g,"wc_sessionSettle",m);case 28:return y=zr(Mr({},m),{topic:g,pairingTopic:u,acknowledged:!1,self:m.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:d}),e.next=31,r.client.session.set(g,y);case 31:return e.next=33,r.setExpiry(g,(0,f.gn)(Sr));case 33:return e.abrupt("return",{topic:g,acknowledged:function(){return new Promise((function(e){return e(r.client.session.get(g))}))}});case 34:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.reject=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidReject(t);case 3:if(n=t.id,s=t.reason,a=r.client.proposal.get(n),o=a.pairingTopic,e.t0=o,!e.t0){e.next=10;break}return e.next=8,r.sendError(n,o,s);case 8:return e.next=10,r.client.proposal.delete(n,(0,f.D6)("USER_DISCONNECTED"));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.update=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidUpdate(t);case 3:return n=t.topic,s=t.namespaces,e.next=7,r.sendRequest(n,"wc_sessionUpdate",{namespaces:s});case 7:return a=e.sent,o=(0,f.H1)(),c=o.done,u=o.resolve,p=o.reject,r.events.once((0,f.E0)("session_update",a),(function(e){var t=e.error;t?p(t):u()})),e.next=15,r.client.session.update(n,{namespaces:s});case 15:return e.abrupt("return",{acknowledged:c});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.extend=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidExtend(t);case 3:return n=t.topic,e.next=6,r.sendRequest(n,"wc_sessionExtend",{});case 6:return s=e.sent,a=(0,f.H1)(),o=a.done,c=a.resolve,u=a.reject,r.events.once((0,f.E0)("session_extend",s),(function(e){var t=e.error;t?u(t):c()})),e.next=14,r.setExpiry(n,(0,f.gn)(Sr));case 14:return e.abrupt("return",{acknowledged:o});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.request=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u,p,l,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidRequest(t);case 3:return n=t.chainId,s=t.request,a=t.topic,o=t.expiry,e.next=9,r.sendRequest(a,"wc_sessionRequest",{request:s,chainId:n},o);case 9:return c=e.sent,u=(0,f.H1)(o),p=u.done,l=u.resolve,h=u.reject,r.events.once((0,f.E0)("session_request",c),(function(e){var t=e.error,n=e.result;t?h(t):l(n)})),r.client.events.emit("session_request_sent",{topic:a,request:s,chainId:n,id:c}),e.next=18,p();case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.respond=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidRespond(t);case 3:if(n=t.topic,s=t.response,a=s.id,!xr(s)){e.next=9;break}return e.next=7,r.sendResult(a,n,s.result);case 7:e.next=13;break;case 9:if(e.t0=br(s),!e.t0){e.next=13;break}return e.next=13,r.sendError(a,n,s.error);case 13:r.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.ping=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidPing(t);case 3:if(n=t.topic,!r.client.session.keys.includes(n)){e.next=17;break}return e.next=7,r.sendRequest(n,"wc_sessionPing",{});case 7:return s=e.sent,a=(0,f.H1)(),o=a.done,c=a.resolve,u=a.reject,r.events.once((0,f.E0)("session_ping",s),(function(e){var t=e.error;t?u(t):c()})),e.next=15,o();case 15:e.next=21;break;case 17:if(e.t0=r.client.core.pairing.pairings.keys.includes(n),!e.t0){e.next=21;break}return e.next=21,r.client.core.pairing.ping({topic:n});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.emit=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidEmit(t);case 3:return n=t.topic,s=t.event,a=t.chainId,e.next=6,r.sendRequest(n,"wc_sessionEvent",{event:s,chainId:a});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.disconnect=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.isInitialized(),e.next=3,r.isValidDisconnect(t);case 3:if(n=t.topic,!r.client.session.keys.includes(n)){e.next=11;break}return e.next=7,r.sendRequest(n,"wc_sessionDelete",(0,f.D6)("USER_DISCONNECTED"));case 7:return e.next=9,r.deleteSession(n);case 9:e.next=13;break;case 11:return e.next=13,r.client.core.pairing.disconnect({topic:n});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.find=function(e){return r.isInitialized(),r.client.session.getAll().filter((function(t){return(0,f.Ih)(t,e)}))},r.getPendingSessionRequests=function(){return r.isInitialized(),r.client.pendingRequest.getAll()},r.deleteSession=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.client.session.get(t),a=s.self,e.next=3,r.client.core.relayer.unsubscribe(t);case 3:return e.next=5,Promise.all([r.client.session.delete(t,(0,f.D6)("USER_DISCONNECTED")),r.client.core.crypto.deleteKeyPair(a.publicKey),r.client.core.crypto.deleteSymKey(t),n?Promise.resolve():r.client.core.expirer.del(t)]);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.deleteProposal=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.client.proposal.delete(t,(0,f.D6)("USER_DISCONNECTED")),n?Promise.resolve():r.client.core.expirer.del(t)]);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.deletePendingSessionRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,a=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.length>2&&void 0!==a[2]&&a[2],e.next=3,Promise.all([r.client.pendingRequest.delete(t,n),s?Promise.resolve():r.client.core.expirer.del(t)]);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.setExpiry=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.client.session.keys.includes(t),!e.t0){e.next=4;break}return e.next=4,r.client.session.update(t,{expiry:n});case 4:r.client.core.expirer.set(t,n);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.setProposal=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.client.proposal.set(t,n);case 2:r.client.core.expirer.set(t,n.expiry);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.setPendingSessionRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_r.wc_sessionRequest.req.ttl,s=t.id,a=t.topic,o=t.params,e.next=3,r.client.pendingRequest.set(s,{id:s,topic:a,params:o});case 3:n&&r.client.core.expirer.set(s,(0,f.gn)(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.sendRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,s,a){var o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n,p=s,o={id:void 0||gr(),jsonrpc:"2.0",method:i,params:p},e.next=3,r.client.core.crypto.encode(t,o);case 3:return c=e.sent,u=_r[n].req,e.abrupt("return",(a&&(u.ttl=a),r.client.core.history.set(t,o),r.client.core.relayer.publish(t,c,u),o.id));case 6:case"end":return e.stop()}var i,p}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),r.sendResult=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,s){var a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={id:t,jsonrpc:"2.0",result:s},e.next=3,r.client.core.crypto.encode(n,a);case 3:return o=e.sent,e.next=6,r.client.core.history.get(n,t);case 6:return c=e.sent,u=_r[c.request.method].res,r.client.core.relayer.publish(n,o,u),e.next=11,r.client.core.history.resolve(a);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),r.sendError=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,s){var a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={id:t,jsonrpc:"2.0",error:mr(s,void 0)},e.next=3,r.client.core.crypto.encode(n,a);case 3:return o=e.sent,e.next=6,r.client.core.history.get(n,t);case 6:return c=e.sent,u=_r[c.request.method].res,r.client.core.relayer.publish(n,o,u),e.next=11,r.client.core.history.resolve(a);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),r.cleanup=(0,s.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r.client.session.getAll().forEach((function(e){(0,f.Bw)(e.expiry)&&t.push(e.topic)})),r.client.proposal.getAll().forEach((function(e){(0,f.Bw)(e.expiry)&&n.push(e.id)})),e.next=5,Promise.all([].concat((0,c.Z)(t.map((function(e){return r.deleteSession(e)}))),(0,c.Z)(n.map((function(e){return r.deleteProposal(e)})))));case 5:case"end":return e.stop()}}),e)}))),r.onRelayEventRequest=function(e){var t=e.topic,n=e.payload,i=n.method;switch(i){case"wc_sessionPropose":return r.onSessionProposeRequest(t,n);case"wc_sessionSettle":return r.onSessionSettleRequest(t,n);case"wc_sessionUpdate":return r.onSessionUpdateRequest(t,n);case"wc_sessionExtend":return r.onSessionExtendRequest(t,n);case"wc_sessionPing":return r.onSessionPingRequest(t,n);case"wc_sessionDelete":return r.onSessionDeleteRequest(t,n);case"wc_sessionRequest":return r.onSessionRequest(t,n);case"wc_sessionEvent":return r.onSessionEventRequest(t,n);default:return r.client.logger.info("Unsupported request method ".concat(i))}},r.onRelayEventResponse=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.topic,s=t.payload,e.next=4,r.client.core.history.get(n,s.id);case 4:a=e.sent.request.method,e.t0=a,e.next="wc_sessionPropose"===e.t0?8:"wc_sessionSettle"===e.t0?9:"wc_sessionUpdate"===e.t0?10:"wc_sessionExtend"===e.t0?11:"wc_sessionPing"===e.t0?12:"wc_sessionRequest"===e.t0?13:14;break;case 8:return e.abrupt("return",r.onSessionProposeResponse(n,s));case 9:return e.abrupt("return",r.onSessionSettleResponse(n,s));case 10:return e.abrupt("return",r.onSessionUpdateResponse(n,s));case 11:return e.abrupt("return",r.onSessionExtendResponse(n,s));case 12:return e.abrupt("return",r.onSessionPingResponse(n,s));case 13:return e.abrupt("return",r.onSessionRequestResponse(n,s));case 14:return e.abrupt("return",r.client.logger.info("Unsupported response method ".concat(a)));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.onSessionProposeRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,a,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.params,a=n.id,e.prev=1,r.isValidConnect(Mr({},n.params)),o=(0,f.gn)(M.FIVE_MINUTES),c=Mr({id:a,pairingTopic:t,expiry:o},s),e.next=6,r.setProposal(a,c);case 6:r.client.events.emit("session_proposal",{id:a,params:c}),e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(1),e.next=13,r.sendError(a,t,e.t0);case 13:r.client.logger.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n){return e.apply(this,arguments)}}(),r.onSessionProposeResponse=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,a,o,c,u,p,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.id,!xr(n)){e.next=22;break}return a=n.result,r.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:a}),o=r.client.proposal.get(s),r.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:o}),c=o.proposer.publicKey,r.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c}),u=a.responderPublicKey,r.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u}),e.next=12,r.client.core.crypto.generateSharedKey(c,u);case 12:return p=e.sent,r.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:p}),e.next=16,r.client.core.relayer.subscribe(p);case 16:return l=e.sent,r.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),e.next=20,r.client.core.pairing.activate({topic:t});case 20:e.next=27;break;case 22:if(e.t0=br(n),!e.t0){e.next=27;break}return e.next=26,r.client.proposal.delete(s,(0,f.D6)("USER_DISCONNECTED"));case 26:r.events.emit((0,f.E0)("session_connect"),{error:n.error});case 27:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.onSessionSettleRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,a,o,c,u,p,l,h,d,v,g,m;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.id,a=n.params,e.prev=1,r.isValidSessionSettleRequest(a),o=n.params,c=o.relay,u=o.controller,p=o.expiry,l=o.namespaces,h=o.requiredNamespaces,d=o.optionalNamespaces,v=o.sessionProperties,g=o.pairingTopic,m=Mr({topic:t,relay:c,expiry:p,namespaces:l,acknowledged:!0,pairingTopic:g,requiredNamespaces:h,optionalNamespaces:d,controller:u.publicKey,self:{publicKey:"",metadata:r.client.metadata},peer:{publicKey:u.publicKey,metadata:u.metadata}},v&&{sessionProperties:v}),e.next=6,r.sendResult(n.id,t,!0);case 6:r.events.emit((0,f.E0)("session_connect"),{session:m}),e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(1),e.next=13,r.sendError(s,t,e.t0);case 13:r.client.logger.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n){return e.apply(this,arguments)}}(),r.onSessionSettleResponse=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.id,!xr(n)){e.next=7;break}return e.next=4,r.client.session.update(t,{acknowledged:!0});case 4:r.events.emit((0,f.E0)("session_approve",s),{}),e.next=12;break;case 7:if(e.t0=br(n),!e.t0){e.next=12;break}return e.next=11,r.client.session.delete(t,(0,f.D6)("USER_DISCONNECTED"));case 11:r.events.emit((0,f.E0)("session_approve",s),{error:n.error});case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.onSessionUpdateRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.params,a=n.id,e.prev=1,r.isValidUpdate(Mr({topic:t},s)),e.next=5,r.client.session.update(t,{namespaces:s.namespaces});case 5:return e.next=7,r.sendResult(a,t,!0);case 7:r.client.events.emit("session_update",{id:a,topic:t,params:s}),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,r.sendError(a,t,e.t0);case 14:r.client.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,n){return e.apply(this,arguments)}}(),r.onSessionUpdateResponse=function(e,t){var n=t.id;xr(t)?r.events.emit((0,f.E0)("session_update",n),{}):br(t)&&r.events.emit((0,f.E0)("session_update",n),{error:t.error})},r.onSessionExtendRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.id,e.prev=1,r.isValidExtend({topic:t}),e.next=5,r.setExpiry(t,(0,f.gn)(Sr));case 5:return e.next=7,r.sendResult(s,t,!0);case 7:r.client.events.emit("session_extend",{id:s,topic:t}),e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,r.sendError(s,t,e.t0);case 14:r.client.logger.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,n){return e.apply(this,arguments)}}(),r.onSessionExtendResponse=function(e,t){var n=t.id;xr(t)?r.events.emit((0,f.E0)("session_extend",n),{}):br(t)&&r.events.emit((0,f.E0)("session_extend",n),{error:t.error})},r.onSessionPingRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.id,e.prev=1,r.isValidPing({topic:t}),e.next=5,r.sendResult(s,t,!0);case 5:r.client.events.emit("session_ping",{id:s,topic:t}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,r.sendError(s,t,e.t0);case 12:r.client.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}(),r.onSessionPingResponse=function(e,t){var n=t.id;setTimeout((function(){xr(t)?r.events.emit((0,f.E0)("session_ping",n),{}):br(t)&&r.events.emit((0,f.E0)("session_ping",n),{error:t.error})}),500)},r.onSessionDeleteRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.id,e.prev=1,r.isValidDisconnect({topic:t,reason:n.params}),r.client.core.relayer.once($t,(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.deleteSession(t);case 2:case"end":return e.stop()}}),e)})))),e.next=6,r.sendResult(a,t,!0);case 6:r.client.events.emit("session_delete",{id:a,topic:t}),e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(1),e.next=13,r.sendError(a,t,e.t0);case 13:r.client.logger.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n){return e.apply(this,arguments)}}(),r.onSessionRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.id,a=n.params,e.prev=1,r.isValidRequest(Mr({topic:t},a)),e.next=5,r.setPendingSessionRequest({id:s,topic:t,params:a});case 5:r.client.events.emit("session_request",{id:s,topic:t,params:a}),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),e.next=12,r.sendError(s,t,e.t0);case 12:r.client.logger.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}(),r.onSessionRequestResponse=function(e,t){var n=t.id;xr(t)?r.events.emit((0,f.E0)("session_request",n),{result:t.result}):br(t)&&r.events.emit((0,f.E0)("session_request",n),{error:t.error})},r.onSessionEventRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=n.id,a=n.params,e.prev=1,r.isValidEmit(Mr({topic:t},a)),r.client.events.emit("session_event",{id:s,topic:t,params:a}),e.next=10;break;case 5:return e.prev=5,e.t0=e.catch(1),e.next=9,r.sendError(s,t,e.t0);case 9:r.client.logger.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,5]])})));return function(t,n){return e.apply(this,arguments)}}(),r.isValidConnect=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u,p,l,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","connect() params: ".concat(JSON.stringify(t))),s=n.message,new Error(s);case 3:if(a=t.pairingTopic,o=t.requiredNamespaces,c=t.optionalNamespaces,u=t.sessionProperties,p=t.relays,e.t0=(0,f.o8)(a),e.t0){e.next=8;break}return e.next=8,r.isValidPairingTopic(a);case 8:if((0,f.PM)(p,!0)){e.next=11;break}throw l=(0,f.Z7)("MISSING_OR_INVALID","connect() relays: ".concat(p)),h=l.message,new Error(h);case 11:!(0,f.o8)(o)&&0!==(0,f.L5)(o)&&r.validateNamespaces(o,"requiredNamespaces"),!(0,f.o8)(c)&&0!==(0,f.L5)(c)&&r.validateNamespaces(c,"optionalNamespaces"),(0,f.o8)(u)||r.validateSessionProps(u,"sessionProperties");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.validateNamespaces=function(e,t){var n=(0,f.n)(e,"connect()",t);if(n)throw new Error(n.message)},r.isValidApprove=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u,p,l,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=2;break}throw new Error((0,f.Z7)("MISSING_OR_INVALID","approve() params: ".concat(t)).message);case 2:return n=t.id,s=t.namespaces,a=t.relayProtocol,o=t.sessionProperties,e.next=5,r.isValidProposalId(n);case 5:if(c=r.client.proposal.get(n),!(u=(0,f.in)(s,"approve()"))){e.next=8;break}throw new Error(u.message);case 8:if(!(p=(0,f.rF)(c.requiredNamespaces,s,"approve()"))){e.next=11;break}throw new Error(p.message);case 11:if((0,f.M_)(a,!0)){e.next=14;break}throw l=(0,f.Z7)("MISSING_OR_INVALID","approve() relayProtocol: ".concat(a)),h=l.message,new Error(h);case 14:(0,f.o8)(o)||r.validateSessionProps(o,"sessionProperties");case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.isValidReject=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","reject() params: ".concat(t)),s=n.message,new Error(s);case 3:return a=t.id,o=t.reason,e.next=6,r.isValidProposalId(a);case 6:if((0,f.$t)(o)){e.next=9;break}throw c=(0,f.Z7)("MISSING_OR_INVALID","reject() reason: ".concat(JSON.stringify(o))),u=c.message,new Error(u);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.isValidSessionSettleRequest=function(e){if(!(0,f.EJ)(e)){var t=(0,f.Z7)("MISSING_OR_INVALID","onSessionSettleRequest() params: ".concat(e)).message;throw new Error(t)}var n=e.relay,r=e.controller,i=e.namespaces,s=e.expiry;if(!(0,f.Z2)(n)){var a=(0,f.Z7)("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string").message;throw new Error(a)}var o=(0,f.Dd)(r,"onSessionSettleRequest()");if(o)throw new Error(o.message);var c=(0,f.in)(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if((0,f.Bw)(s)){var u=(0,f.Z7)("EXPIRED","onSessionSettleRequest()").message;throw new Error(u)}},r.isValidUpdate=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","update() params: ".concat(t)),s=n.message,new Error(s);case 3:return a=t.topic,o=t.namespaces,e.next=6,r.isValidSessionTopic(a);case 6:if(c=r.client.session.get(a),!(u=(0,f.in)(o,"update()"))){e.next=9;break}throw new Error(u.message);case 9:if(!(p=(0,f.rF)(c.requiredNamespaces,o,"update()"))){e.next=12;break}throw new Error(p.message);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.isValidExtend=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","extend() params: ".concat(t)),s=n.message,new Error(s);case 3:return a=t.topic,e.next=6,r.isValidSessionTopic(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.isValidRequest=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u,p,l,h,d,v,g,m,y,w,x;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","request() params: ".concat(t)),s=n.message,new Error(s);case 3:return a=t.topic,o=t.request,c=t.chainId,u=t.expiry,e.next=6,r.isValidSessionTopic(a);case 6:if(p=r.client.session.get(a),l=p.namespaces,(0,f.p8)(l,c)){e.next=10;break}throw h=(0,f.Z7)("MISSING_OR_INVALID","request() chainId: ".concat(c)),d=h.message,new Error(d);case 10:if((0,f.hH)(o)){e.next=13;break}throw v=(0,f.Z7)("MISSING_OR_INVALID","request() ".concat(JSON.stringify(o))),g=v.message,new Error(g);case 13:if((0,f.al)(l,c,o.method)){e.next=16;break}throw m=(0,f.Z7)("MISSING_OR_INVALID","request() method: ".concat(o.method)),y=m.message,new Error(y);case 16:if(!u||(0,f.ON)(u,Rr)){e.next=19;break}throw w=(0,f.Z7)("MISSING_OR_INVALID","request() expiry: ".concat(u,". Expiry must be a number (in seconds) between ").concat(Rr.min," and ").concat(Rr.max)),x=w.message,new Error(x);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.isValidRespond=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","respond() params: ".concat(t)),s=n.message,new Error(s);case 3:return a=t.topic,o=t.response,e.next=6,r.isValidSessionTopic(a);case 6:if((0,f.JT)(o)){e.next=9;break}throw c=(0,f.Z7)("MISSING_OR_INVALID","respond() response: ".concat(JSON.stringify(o))),u=c.message,new Error(u);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.isValidPing=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","ping() params: ".concat(t)),s=n.message,new Error(s);case 3:return a=t.topic,e.next=6,r.isValidSessionOrPairingTopic(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.isValidEmit=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,o,c,u,p,l,h,d,v,g,m;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","emit() params: ".concat(t)),s=n.message,new Error(s);case 3:return a=t.topic,o=t.event,c=t.chainId,e.next=6,r.isValidSessionTopic(a);case 6:if(u=r.client.session.get(a),p=u.namespaces,(0,f.p8)(p,c)){e.next=10;break}throw l=(0,f.Z7)("MISSING_OR_INVALID","emit() chainId: ".concat(c)),h=l.message,new Error(h);case 10:if((0,f.nf)(o)){e.next=13;break}throw d=(0,f.Z7)("MISSING_OR_INVALID","emit() event: ".concat(JSON.stringify(o))),v=d.message,new Error(v);case 13:if((0,f.sI)(p,c,o.name)){e.next=16;break}throw g=(0,f.Z7)("MISSING_OR_INVALID","emit() event: ".concat(JSON.stringify(o))),m=g.message,new Error(m);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.isValidDisconnect=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.EJ)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","disconnect() params: ".concat(t)),s=n.message,new Error(s);case 3:return a=t.topic,e.next=6,r.isValidSessionOrPairingTopic(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.validateSessionProps=function(e,t){Object.values(e).forEach((function(e){if(!(0,f.M_)(e,!1)){var n=(0,f.Z7)("MISSING_OR_INVALID","".concat(t," must be in Record<string, string> format. Received: ").concat(JSON.stringify(e))).message;throw new Error(n)}}))},r}return(0,o.Z)(n,[{key:"isInitialized",value:function(){if(!this.initialized){var e=(0,f.Z7)("NOT_INITIALIZED",this.name).message;throw new Error(e)}}},{key:"registerRelayerEvents",value:function(){var e=this;this.client.core.relayer.on(Bt,function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){var r,s,a;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.topic,s=n.message,!e.ignoredPayloadTypes.includes(e.client.core.crypto.getPayloadType(s))){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.client.core.crypto.decode(r,s);case 5:if(a=t.sent,!yr(i=a)||!("method"in i)){t.next=10;break}e.client.core.history.set(r,a),e.onRelayEventRequest({topic:r,payload:a}),t.next=15;break;case 10:if(t.t0=wr(a),!t.t0){t.next=15;break}return t.next=14,e.client.core.history.resolve(a);case 14:e.onRelayEventResponse({topic:r,payload:a});case 15:case"end":return t.stop()}var i}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerExpirerEvents",value:function(){var e=this;this.client.core.expirer.on(yn,function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){var r,s,a;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(0,f.iP)(n.target),s=r.topic,!(a=r.id)||!e.client.pendingRequest.keys.includes(a)){t.next=5;break}return t.next=4,e.deletePendingSessionRequest(a,(0,f.Z7)("EXPIRED"),!0);case 4:return t.abrupt("return",t.sent);case 5:if(!s){t.next=13;break}if(t.t0=e.client.session.keys.includes(s),!t.t0){t.next=11;break}return t.next=10,e.deleteSession(s,!0);case 10:e.client.events.emit("session_expire",{topic:s});case 11:t.next=18;break;case 13:if(t.t1=a,!t.t1){t.next=18;break}return t.next=17,e.deleteProposal(a,!0);case 17:e.client.events.emit("proposal_expire",{id:a});case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"isValidPairingTopic",value:function(e){if(!(0,f.M_)(e,!1)){var t=(0,f.Z7)("MISSING_OR_INVALID","pairing topic should be a string: ".concat(e)).message;throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){var n=(0,f.Z7)("NO_MATCHING_KEY","pairing topic doesn't exist: ".concat(e)).message;throw new Error(n)}if((0,f.Bw)(this.client.core.pairing.pairings.get(e).expiry)){var r=(0,f.Z7)("EXPIRED","pairing topic: ".concat(e)).message;throw new Error(r)}}},{key:"isValidSessionTopic",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r,s,a,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.M_)(t,!1)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","session topic should be a string: ".concat(t)),r=n.message,new Error(r);case 3:if(this.client.session.keys.includes(t)){e.next=6;break}throw s=(0,f.Z7)("NO_MATCHING_KEY","session topic doesn't exist: ".concat(t)),a=s.message,new Error(a);case 6:if(!(0,f.Bw)(this.client.session.get(t).expiry)){e.next=11;break}return e.next=9,this.deleteSession(t);case 9:throw o=(0,f.Z7)("EXPIRED","session topic: ".concat(t)),c=o.message,new Error(c);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isValidSessionOrPairingTopic",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r,s,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.client.session.keys.includes(t)){e.next=5;break}return e.next=3,this.isValidSessionTopic(t);case 3:e.next=16;break;case 5:if(!this.client.core.pairing.pairings.keys.includes(t)){e.next=9;break}this.isValidPairingTopic(t),e.next=16;break;case 9:if(!(0,f.M_)(t,!1)){e.next=14;break}throw n=(0,f.Z7)("NO_MATCHING_KEY","session or pairing topic doesn't exist: ".concat(t)),r=n.message,new Error(r);case 14:throw s=(0,f.Z7)("MISSING_OR_INVALID","session or pairing topic should be a string: ".concat(t)),a=s.message,new Error(a);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isValidProposalId",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r,s,a,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.Q0)(t)){e.next=3;break}throw n=(0,f.Z7)("MISSING_OR_INVALID","proposal id should be a number: ".concat(t)),r=n.message,new Error(r);case 3:if(this.client.proposal.keys.includes(t)){e.next=6;break}throw s=(0,f.Z7)("NO_MATCHING_KEY","proposal id doesn't exist: ".concat(t)),a=s.message,new Error(a);case 6:if(!(0,f.Bw)(this.client.proposal.get(t).expiry)){e.next=11;break}return e.next=9,this.deleteProposal(t);case 9:throw o=(0,f.Z7)("EXPIRED","proposal id: ".concat(t)),c=o.message,new Error(c);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(or),jr=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,a.Z)(this,n),(i=t.call(this,e,r,"proposal",kr)).core=e,i.logger=r,i}return(0,o.Z)(n)}(Yn),Ur=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,a.Z)(this,n),(i=t.call(this,e,r,"session",kr)).core=e,i.logger=r,i}return(0,o.Z)(n)}(Yn),Vr=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,a.Z)(this,n),(i=t.call(this,e,r,"request",kr,(function(e){return e.id}))).core=e,i.logger=r,i}return(0,o.Z)(n)}(Yn),Kr=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;(0,a.Z)(this,n),(r=t.call(this,e)).protocol="wc",r.version=2,r.name=Er,r.events=new l.EventEmitter,r.on=function(e,t){return r.events.on(e,t)},r.once=function(e,t){return r.events.once(e,t)},r.off=function(e,t){return r.events.off(e,t)},r.removeListener=function(e,t){return r.events.removeListener(e,t)},r.removeAllListeners=function(e){return r.events.removeAllListeners(e)},r.connect=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.connect(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.pair=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.pair(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.approve=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.approve(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.reject=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.reject(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.update=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.update(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.extend=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.extend(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.request=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.request(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.respond=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.respond(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.ping=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.ping(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.emit=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.emit(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.disconnect=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.engine.disconnect(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),r.logger.error(e.t0.message),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),r.find=function(e){try{return r.engine.find(e)}catch(t){throw r.logger.error(t.message),t}},r.getPendingSessionRequests=function(){try{return r.engine.getPendingSessionRequests()}catch(e){throw r.logger.error(e.message),e}},r.name=(null===e||void 0===e?void 0:e.name)||Er,r.metadata=(null===e||void 0===e?void 0:e.metadata)||(0,f.D)();var o=typeof(null===e||void 0===e?void 0:e.logger)<"u"&&"string"!=typeof(null===e||void 0===e?void 0:e.logger)?e.logger:v()((0,Z.getDefaultLoggerOptions)({level:(null===e||void 0===e?void 0:e.logger)||Ir}));return r.core=(null===e||void 0===e?void 0:e.core)||new sr(e),r.logger=(0,Z.generateChildLogger)(o,r.name),r.session=new Ur(r.core,r.logger),r.proposal=new jr(r.core,r.logger),r.pendingRequest=new Vr(r.core,r.logger),r.engine=new Lr((0,g.Z)(r)),r}return(0,o.Z)(n,[{key:"context",get:function(){return(0,Z.getLoggerContext)(this.logger)}},{key:"pairing",get:function(){return this.core.pairing.pairings}},{key:"initialize",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.prev=1,e.next=4,this.core.start();case 4:return e.next=6,this.session.init();case 6:return e.next=8,this.proposal.init();case 8:return e.next=10,this.pendingRequest.init();case 10:return e.next=12,this.engine.init();case 12:this.logger.info("SignClient Initialization Success"),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(1),this.logger.info("SignClient Initialization Failure"),this.logger.error(e.t0.message),e.t0;case 18:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(){return e.apply(this,arguments)}}()}],[{key:"init",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new n(t),e.next=3,r.initialize();case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ar),Hr=n(17507),Gr="error",Jr="".concat("wc","@",2,":").concat("universal_provider",":"),Br="default_chain_changed",Yr=Object.defineProperty,Fr=Object.getOwnPropertySymbols,Wr=Object.prototype.hasOwnProperty,Qr=Object.prototype.propertyIsEnumerable,Xr=function(e,t,n){return t in e?Yr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},$r=function(e,t){for(var n in t||(t={}))Wr.call(t,n)&&Xr(e,n,t[n]);if(Fr){var r,i=(0,p.Z)(Fr(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Qr.call(t,n)&&Xr(e,n,t[n])}}catch(s){i.e(s)}finally{i.f()}}return e};function ei(e,t,n){var r,i=ti(e);return t.rpcMap&&(r=t.rpcMap[i]),r||(r="".concat("https://rpc.walletconnect.com/v1","?chainId=eip155:").concat(i,"&projectId=").concat(n)),r}function ti(e){return e.includes("eip155")?Number(e.split(":")[1]):Number(e)}function ni(e){var t,n,i,s,a={};if(!(0,f.L5)(e))return a;for(var o=0,c=Object.entries(e);o<c.length;o++){var u=(0,r.Z)(c[o],2),p=u[0],l=u[1],h=ri(p)?[p]:l.chains,d=l.methods||[],v=l.events||[],g=ii(p);a[g]={chains:si(h,null==(t=a[g])?void 0:t.chains),methods:si(d,null==(n=a[g])?void 0:n.methods),events:si(v,null==(i=a[g])?void 0:i.events),rpcMap:$r($r({},null==(s=a[g])?void 0:s.rpcMap),l.rpcMap)}}return a}function ri(e){return e.includes(":")}function ii(e){return ri(e)?e.split(":")[0]:e}function si(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(0,c.Z)(new Set([].concat((0,c.Z)(e),(0,c.Z)(t))))}var ai=function(e,t){e.on("session_request_sent",(function n(r){r.request!==t.request||r.topic!==t.topic||(e.events.removeListener("session_request_sent",n),function(e){if(typeof window<"u")try{var t=window.localStorage.getItem("WALLETCONNECT_DEEPLINK_CHOICE");if(t){var n=JSON.parse(t),r=null===n||void 0===n?void 0:n.href;if("string"==typeof r){r.endsWith("/")&&r.slice(0,-1);var i="".concat(r,"/wc?requestId=").concat(e.id,"&sessionTopic=").concat(e.topic);window.open(i,"_self","noreferrer noopener")}}}catch(t){console.error(t)}}(t))}))};var oi=function(){function e(t){(0,a.Z)(this,e),this.name="eip155",this.namespace=t.namespace,this.client=t.client,this.events=t.events,this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}return(0,o.Z)(e,[{key:"request",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.request.method,e.next="eth_requestAccounts"===e.t0?3:"eth_accounts"===e.t0?4:"wallet_switchEthereumChain"===e.t0?5:"eth_chainId"===e.t0?6:7;break;case 3:case 4:return e.abrupt("return",this.getAccounts());case 5:return e.abrupt("return",(this.handleSwitchChain(t.request.params?null==(n=t.request.params[0])?void 0:n.chainId:"0x0"),null));case 6:return e.abrupt("return",parseInt(this.getDefaultChain()));case 7:if(!this.namespace.methods.includes(t.request.method)){e.next=14;break}return ai(this.client,t),e.next=11,this.client.request(t);case 11:e.t1=e.sent,e.next=15;break;case 14:e.t1=this.getHttpProvider().request(t.request);case 15:return e.abrupt("return",e.t1);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateNamespace",value:function(e){this.namespace=Object.assign(this.namespace,e)}},{key:"setDefaultChain",value:function(e,t){var n=ti(e);if(!this.httpProviders[n]){var r=t||ei("".concat(this.name,":").concat(n),this.namespace,this.client.core.projectId);if(!r)throw new Error("No RPC url provided for chainId: ".concat(n));this.setHttpProvider(n,r)}this.chainId=n,this.events.emit(Br,"".concat(this.name,":").concat(n))}},{key:"requestAccounts",value:function(){return this.getAccounts()}},{key:"getDefaultChain",value:function(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;var e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}},{key:"createHttpProvider",value:function(e,t){var n=t||ei("".concat(this.name,":").concat(e),this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new z.r(new Hr.k(n))}},{key:"setHttpProvider",value:function(e,t){var n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}},{key:"createHttpProviders",value:function(){var e=this,t={};return this.namespace.chains.forEach((function(n){var r,i=ti(n);t[i]=e.createHttpProvider(i,null==(r=e.namespace.rpcMap)?void 0:r[n])})),t}},{key:"getAccounts",value:function(){var e=this,t=this.namespace.accounts;return t?(0,c.Z)(new Set(t.filter((function(t){return t.split(":")[1]===e.chainId.toString()})).map((function(e){return e.split(":")[2]})))):[]}},{key:"getHttpProvider",value:function(){var e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}},{key:"handleSwitchChain",value:function(e){var t=parseInt(e,16);(function(e,t){if(!t.includes(e))throw new Error("Chain '".concat(e,"' not approved. Please use one of the following: ").concat(t.toString()))})("".concat(this.name,":").concat(t),this.namespace.chains),this.setDefaultChain("".concat(t))}}]),e}(),ci=function(){function e(t){(0,a.Z)(this,e),this.name="solana",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}return(0,o.Z)(e,[{key:"updateNamespace",value:function(e){this.namespace=Object.assign(this.namespace,e)}},{key:"requestAccounts",value:function(){return this.getAccounts()}},{key:"request",value:function(e){return this.namespace.methods.includes(e.request.method)?(ai(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}},{key:"setDefaultChain",value:function(e,t){if(!this.httpProviders[e]){var n=t||ei("".concat(this.name,":").concat(e),this.namespace,this.client.core.projectId);if(!n)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,n)}this.chainId=e,this.events.emit(Br,"".concat(this.name,":").concat(this.chainId))}},{key:"getDefaultChain",value:function(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;var e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}},{key:"getAccounts",value:function(){var e=this,t=this.namespace.accounts;return t?(0,c.Z)(new Set(t.filter((function(t){return t.split(":")[1]===e.chainId.toString()})).map((function(e){return e.split(":")[2]})))):[]}},{key:"createHttpProviders",value:function(){var e=this,t={};return this.namespace.chains.forEach((function(n){var r;t[n]=e.createHttpProvider(n,null==(r=e.namespace.rpcMap)?void 0:r[n])})),t}},{key:"getHttpProvider",value:function(){var e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}},{key:"setHttpProvider",value:function(e,t){var n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}},{key:"createHttpProvider",value:function(e,t){var n=t||ei(e,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new z.r(new Hr.Z(n))}}]),e}(),ui=function(){function e(t){(0,a.Z)(this,e),this.name="cosmos",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}return(0,o.Z)(e,[{key:"updateNamespace",value:function(e){this.namespace=Object.assign(this.namespace,e)}},{key:"requestAccounts",value:function(){return this.getAccounts()}},{key:"getDefaultChain",value:function(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;var e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}},{key:"request",value:function(e){return this.namespace.methods.includes(e.request.method)?(ai(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}},{key:"setDefaultChain",value:function(e,t){if(this.chainId=e,!this.httpProviders[e]){var n=t||ei("".concat(this.name,":").concat(e),this.namespace,this.client.core.projectId);if(!n)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,n)}this.events.emit(Br,"".concat(this.name,":").concat(this.chainId))}},{key:"getAccounts",value:function(){var e=this,t=this.namespace.accounts;return t?(0,c.Z)(new Set(t.filter((function(t){return t.split(":")[1]===e.chainId.toString()})).map((function(e){return e.split(":")[2]})))):[]}},{key:"createHttpProviders",value:function(){var e=this,t={};return this.namespace.chains.forEach((function(n){var r;t[n]=e.createHttpProvider(n,null==(r=e.namespace.rpcMap)?void 0:r[n])})),t}},{key:"getHttpProvider",value:function(){var e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}},{key:"setHttpProvider",value:function(e,t){var n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}},{key:"createHttpProvider",value:function(e,t){var n=t||ei(e,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new z.r(new Hr.Z(n))}}]),e}(),pi=function(){function e(t){(0,a.Z)(this,e),this.name="cip34",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}return(0,o.Z)(e,[{key:"updateNamespace",value:function(e){this.namespace=Object.assign(this.namespace,e)}},{key:"requestAccounts",value:function(){return this.getAccounts()}},{key:"getDefaultChain",value:function(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;var e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}},{key:"request",value:function(e){return this.namespace.methods.includes(e.request.method)?(ai(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}},{key:"setDefaultChain",value:function(e,t){if(this.chainId=e,!this.httpProviders[e]){var n=t||this.getCardanoRPCUrl(e);if(!n)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,n)}this.events.emit(Br,"".concat(this.name,":").concat(this.chainId))}},{key:"getAccounts",value:function(){var e=this,t=this.namespace.accounts;return t?(0,c.Z)(new Set(t.filter((function(t){return t.split(":")[1]===e.chainId.toString()})).map((function(e){return e.split(":")[2]})))):[]}},{key:"createHttpProviders",value:function(){var e=this,t={};return this.namespace.chains.forEach((function(n){var r=e.getCardanoRPCUrl(n);t[n]=e.createHttpProvider(n,r)})),t}},{key:"getHttpProvider",value:function(){var e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}},{key:"getCardanoRPCUrl",value:function(e){var t=this.namespace.rpcMap;if(t)return t[e]}},{key:"setHttpProvider",value:function(e,t){var n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}},{key:"createHttpProvider",value:function(e,t){var n=t||this.getCardanoRPCUrl(e);return typeof n>"u"?void 0:new z.r(new Hr.Z(n))}}]),e}(),li=function(){function e(t){(0,a.Z)(this,e),this.name="elrond",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}return(0,o.Z)(e,[{key:"updateNamespace",value:function(e){this.namespace=Object.assign(this.namespace,e)}},{key:"requestAccounts",value:function(){return this.getAccounts()}},{key:"request",value:function(e){return this.namespace.methods.includes(e.request.method)?(ai(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}},{key:"setDefaultChain",value:function(e,t){if(!this.httpProviders[e]){var n=t||ei("".concat(this.name,":").concat(e),this.namespace,this.client.core.projectId);if(!n)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,n)}this.chainId=e,this.events.emit(Br,"".concat(this.name,":").concat(this.chainId))}},{key:"getDefaultChain",value:function(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;var e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}},{key:"getAccounts",value:function(){var e=this,t=this.namespace.accounts;return t?(0,c.Z)(new Set(t.filter((function(t){return t.split(":")[1]===e.chainId.toString()})).map((function(e){return e.split(":")[2]})))):[]}},{key:"createHttpProviders",value:function(){var e=this,t={};return this.namespace.chains.forEach((function(n){var r;t[n]=e.createHttpProvider(n,null==(r=e.namespace.rpcMap)?void 0:r[n])})),t}},{key:"getHttpProvider",value:function(){var e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}},{key:"setHttpProvider",value:function(e,t){var n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}},{key:"createHttpProvider",value:function(e,t){var n=t||ei(e,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new z.r(new Hr.Z(n))}}]),e}(),hi=function(){function e(t){(0,a.Z)(this,e),this.name="multiversx",this.namespace=t.namespace,this.events=t.events,this.client=t.client,this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}return(0,o.Z)(e,[{key:"updateNamespace",value:function(e){this.namespace=Object.assign(this.namespace,e)}},{key:"requestAccounts",value:function(){return this.getAccounts()}},{key:"request",value:function(e){return this.namespace.methods.includes(e.request.method)?(ai(this.client,e),this.client.request(e)):this.getHttpProvider().request(e.request)}},{key:"setDefaultChain",value:function(e,t){if(!this.httpProviders[e]){var n=t||ei("".concat(this.name,":").concat(e),this.namespace,this.client.core.projectId);if(!n)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,n)}this.chainId=e,this.events.emit(Br,"".concat(this.name,":").concat(this.chainId))}},{key:"getDefaultChain",value:function(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;var e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}},{key:"getAccounts",value:function(){var e=this,t=this.namespace.accounts;return t?(0,c.Z)(new Set(t.filter((function(t){return t.split(":")[1]===e.chainId.toString()})).map((function(e){return e.split(":")[2]})))):[]}},{key:"createHttpProviders",value:function(){var e=this,t={};return this.namespace.chains.forEach((function(n){var r;t[n]=e.createHttpProvider(n,null==(r=e.namespace.rpcMap)?void 0:r[n])})),t}},{key:"getHttpProvider",value:function(){var e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}},{key:"setHttpProvider",value:function(e,t){var n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}},{key:"createHttpProvider",value:function(e,t){var n=t||ei(e,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new z.r(new Hr.Z(n))}}]),e}(),fi=Object.defineProperty,di=Object.defineProperties,vi=Object.getOwnPropertyDescriptors,gi=Object.getOwnPropertySymbols,mi=Object.prototype.hasOwnProperty,yi=Object.prototype.propertyIsEnumerable,wi=function(e,t,n){return t in e?fi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},xi=function(e,t){for(var n in t||(t={}))mi.call(t,n)&&wi(e,n,t[n]);if(gi){var r,i=(0,p.Z)(gi(t));try{for(i.s();!(r=i.n()).done;){n=r.value;yi.call(t,n)&&wi(e,n,t[n])}}catch(s){i.e(s)}finally{i.f()}}return e},bi=function(e,t){return di(e,vi(t))},Zi=function(){function e(t){(0,a.Z)(this,e),this.events=new(h()),this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.providerOpts=t,this.logger=typeof(null===t||void 0===t?void 0:t.logger)<"u"&&"string"!=typeof(null===t||void 0===t?void 0:t.logger)?t.logger:v()((0,Z.getDefaultLoggerOptions)({level:(null===t||void 0===t?void 0:t.logger)||Gr}))}return(0,o.Z)(e,[{key:"request",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,a,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.validateChain(n),a=(0,r.Z)(s,2),o=a[0],c=a[1],this.session){e.next=3;break}throw new Error("Please call connect() before request()");case 3:return e.next=5,this.getProvider(o).request({request:xi({},t),chainId:"".concat(o,":").concat(c),topic:this.session.topic});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendAsync",value:function(e,t,n){this.request(e,n).then((function(e){return t(null,e)})).catch((function(e){return t(e,void 0)}))}},{key:"enable",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client){e.next=2;break}throw new Error("Sign Client not initialized");case 2:if(e.t0=this.session,e.t0){e.next=6;break}return e.next=6,this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});case 6:return e.next=8,this.requestAccounts();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.session){e.next=2;break}throw new Error("Please call connect() before enable()");case 2:return e.next=4,this.client.disconnect({topic:null==(t=this.session)?void 0:t.topic,reason:(0,f.D6)("USER_DISCONNECTED")});case 4:return e.next=6,this.cleanup();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client){e.next=2;break}throw new Error("Sign Client not initialized");case 2:return this.setNamespaces(t),e.next=5,this.cleanupPendingPairings();case 5:if(t.skipPairing){e.next=9;break}return e.next=8,this.pair(t.pairingTopic);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"removeListener",value:function(e,t){this.events.removeListener(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"isWalletConnect",get:function(){return!0}},{key:"pair",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r,s,a,o=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.shouldAbortPairingAttempt=!1,n=0;case 2:if(!this.shouldAbortPairingAttempt){e.next=4;break}throw new Error("Pairing aborted");case 4:if(!(n>=this.maxPairingAttempts)){e.next=6;break}throw new Error("Max auto pairing attempts reached");case 6:return e.next=8,this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});case 8:return r=e.sent,s=r.uri,a=r.approval,s&&(this.uri=s,this.events.emit("display_uri",s)),e.next=14,a().then((function(e){o.session=e})).catch((function(e){if(e.message!==Pr)throw e;n++}));case 14:if(!this.session){e.next=2;break}case 15:return e.abrupt("return",(this.onConnect(),this.session));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setDefaultChain",value:function(e,t){try{var n=this.validateChain(e),i=(0,r.Z)(n,2),s=i[0],a=i[1];this.getProvider(s).setDefaultChain(a,t)}catch(s){if(!/Please call connect/.test(s.message))throw s}}},{key:"cleanupPendingPairings",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t,n,r,s,a,o=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{},this.logger.info("Cleaning up inactive pairings..."),n=this.client.pairing.getAll(),!(0,f.qt)(n)){e.next=26;break}r=(0,p.Z)(n),e.prev=5,r.s();case 7:if((s=r.n()).done){e.next=17;break}if(a=s.value,!t.deletePairings){e.next=13;break}this.client.core.expirer.set(a.topic,0),e.next=15;break;case 13:return e.next=15,this.client.core.relayer.subscriber.unsubscribe(a.topic);case 15:e.next=7;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(5),r.e(e.t0);case 22:return e.prev=22,r.f(),e.finish(22);case 25:this.logger.info("Inactive pairings cleared: ".concat(n.length));case 26:case"end":return e.stop()}}),e,this,[[5,19,22,25]])})));return function(){return e.apply(this,arguments)}}()},{key:"abortPairingAttempt",value:function(){this.shouldAbortPairingAttempt=!0}},{key:"checkStorage",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFromStore("namespaces");case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:return this.namespaces=e.t0,e.next=8,this.getFromStore("optionalNamespaces");case 8:if(e.t1=e.sent,e.t1){e.next=11;break}e.t1={};case 11:if(this.optionalNamespaces=e.t1,!this.client.session.length){e.next=15;break}t=this.client.session.keys.length-1,this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders();case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initialize",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Initialized"),e.next=3,this.createClient();case 3:return e.next=5,this.checkStorage();case 5:this.registerEventListeners();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createClient",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.providerOpts.client,e.t0){e.next=5;break}return e.next=4,Kr.init({logger:this.providerOpts.logger||Gr,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.com",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name});case 4:e.t0=e.sent;case 5:this.client=e.t0,this.logger.trace("SignClient Initialized");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createProviders",value:function(){var e=this;if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");(0,c.Z)(new Set(Object.keys(this.session.namespaces).map((function(e){return ii(e)})))).forEach((function(t){if(e.session){var n=function(e,t){var n=Object.keys(t.namespaces).filter((function(t){return t.includes(e)}));if(!n.length)return[];var r=[];return n.forEach((function(e){var n=t.namespaces[e].accounts;r.push.apply(r,(0,c.Z)(n))})),r}(t,e.session),r=n.map((function(e){return"".concat(e.split(":")[0],":").concat(e.split(":")[1])})),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ni(e),r=ni(t);return $r({},Object.assign(n,r))}(e.namespaces,e.optionalNamespaces),s=bi(xi({},i[t]),{accounts:n,chains:r});switch(t){case"eip155":e.rpcProviders[t]=new oi({client:e.client,namespace:s,events:e.events});break;case"solana":e.rpcProviders[t]=new ci({client:e.client,namespace:s,events:e.events});break;case"cosmos":e.rpcProviders[t]=new ui({client:e.client,namespace:s,events:e.events});break;case"polkadot":break;case"cip34":e.rpcProviders[t]=new pi({client:e.client,namespace:s,events:e.events});break;case"elrond":e.rpcProviders[t]=new li({client:e.client,namespace:s,events:e.events});break;case"multiversx":e.rpcProviders[t]=new hi({client:e.client,namespace:s,events:e.events})}}}))}},{key:"registerEventListeners",value:function(){var e=this;if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",(function(t){e.events.emit("session_ping",t)})),this.client.on("session_event",(function(t){var n=t.params,r=n.event;"accountsChanged"===r.name?e.events.emit("accountsChanged",r.data):"chainChanged"===r.name?e.onChainChanged(n.chainId):e.events.emit(r.name,r.data),e.events.emit("session_event",t)})),this.client.on("session_update",(function(t){var n,r=t.topic,i=t.params,s=i.namespaces,a=null==(n=e.client)?void 0:n.session.get(r);e.session=bi(xi({},a),{namespaces:s}),e.onSessionUpdate(),e.events.emit("session_update",{topic:r,params:i})})),this.client.on("session_delete",function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.cleanup();case 2:e.events.emit("session_delete",n),e.events.emit("disconnect",bi(xi({},(0,f.D6)("USER_DISCONNECTED")),{data:n.topic}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.on(Br,(function(t){e.onChainChanged(t,!0)}))}},{key:"getProvider",value:function(e){if(!this.rpcProviders[e])throw new Error("Provider not found: ".concat(e));return this.rpcProviders[e]}},{key:"onSessionUpdate",value:function(){var e=this;Object.keys(this.rpcProviders).forEach((function(t){var n;e.getProvider(t).updateNamespace(null==(n=e.session)?void 0:n.namespaces[t])}))}},{key:"setNamespaces",value:function(e){var t=e.namespaces,n=e.optionalNamespaces,r=e.sessionProperties;if(!t||!Object.keys(t).length)throw new Error("Namespaces must be not empty");this.namespaces=t,this.optionalNamespaces=n,this.sessionProperties=r,this.persist("namespaces",t),this.persist("optionalNamespaces",n)}},{key:"validateChain",value:function(e){var t=(null===e||void 0===e?void 0:e.split(":"))||["",""],n=(0,r.Z)(t,2),i=n[0],s=n[1];if(i&&!Object.keys(this.namespaces).includes(i))throw new Error("Namespace '".concat(i,"' is not configured. Please call connect() first with namespace config."));if(i&&s)return[i,s];var a=Object.keys(this.namespaces)[0];return[a,this.rpcProviders[a].getDefaultChain()]}},{key:"requestAccounts",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t,n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.validateChain(),n=(0,r.Z)(t,1),s=n[0],e.next=3,this.getProvider(s).requestAccounts();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onChainChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.validateChain(e),i=(0,r.Z)(n,2),s=i[0],a=i[1];t||this.getProvider(s).setDefaultChain(a),this.namespaces[s].defaultChain=a,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",a)}},{key:"onConnect",value:function(){this.createProviders(),this.events.emit("connect",{session:this.session})}},{key:"cleanup",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.session=void 0,e.next=3,this.cleanupPendingPairings({deletePairings:!0});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"persist",value:function(e,t){this.client.core.storage.setItem("".concat(Jr,"/").concat(e),t)}},{key:"getFromStore",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.core.storage.getItem("".concat(Jr,"/").concat(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"init",value:function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){var r;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new e(n),t.next=3,r.initialize();case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),ki=Zi,Ei="".concat("wc","@",2,":").concat("ethereum_provider",":"),Ii=["eth_sendTransaction","personal_sign"],Pi=["eth_accounts","eth_requestAccounts","eth_call","eth_getBalance","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Si=["chainChanged","accountsChanged"],_i=["message","disconnect","connect"],Ri=Object.defineProperty,Ci=Object.defineProperties,Ni=Object.getOwnPropertyDescriptors,Oi=Object.getOwnPropertySymbols,qi=Object.prototype.hasOwnProperty,Di=Object.prototype.propertyIsEnumerable,Ai=function(e,t,n){return t in e?Ri(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Ti=function(e,t){for(var n in t||(t={}))qi.call(t,n)&&Ai(e,n,t[n]);if(Oi){var r,i=(0,p.Z)(Oi(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Di.call(t,n)&&Ai(e,n,t[n])}}catch(s){i.e(s)}finally{i.f()}}return e},Mi=function(e,t){return Ci(e,Ni(t))};function zi(e){return Number(e[0].split(":")[1])}function Li(e){return"0x".concat(e.toString(16))}function ji(e){var t=e.chains,n=e.optionalChains,r=e.methods,i=e.optionalMethods,s=e.events,a=e.optionalEvents,o=e.rpcMap;if(!(0,f.qt)(t))throw new Error("Invalid chains");var p=t,l=r||Ii,h=s||Si,d={chains:p,methods:l,events:h,rpcMap:(0,u.Z)({},zi(p),o[zi(p)])},v=null===s||void 0===s?void 0:s.filter((function(e){return!Si.includes(e)})),g=null===r||void 0===r?void 0:r.filter((function(e){return!Ii.includes(e)}));if(!n&&!a&&!i&&(null==v||!v.length)&&(null==g||!g.length))return{required:d};var m=(null===v||void 0===v?void 0:v.length)&&(null===g||void 0===g?void 0:g.length)||!n;return{required:d,optional:{chains:(0,c.Z)(new Set(m?p.concat(n||[]):n)),methods:(0,c.Z)(new Set(l.concat(i||[]))),events:(0,c.Z)(new Set(h.concat(a||[]))),rpcMap:o}}}var Ui=function(){function e(){var t=this;(0,a.Z)(this,e),this.events=new l.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Ei,this.on=function(e,n){return t.events.on(e,n),t},this.once=function(e,n){return t.events.once(e,n),t},this.removeListener=function(e,n){return t.events.removeListener(e,n),t},this.off=function(e,n){return t.events.off(e,n),t},this.parseAccount=function(e){return t.isCompatibleChainId(e)?t.parseAccountId(e).address:e},this.signer={},this.rpc={}}return(0,o.Z)(e,[{key:"request",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signer.request(t,this.formatChainId(this.chainId));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendAsync",value:function(e,t){this.signer.sendAsync(e,t,this.formatChainId(this.chainId))}},{key:"connected",get:function(){return!!this.signer.client&&this.signer.client.core.relayer.connected}},{key:"connecting",get:function(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}},{key:"enable",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.session,e.t0){e.next=4;break}return e.next=4,this.connect();case 4:return e.next=6,this.request({method:"eth_requestAccounts"});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,r,a,o,c,p=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer.client){e.next=2;break}throw new Error("Provider not initialized. Call init() first");case 2:return this.loadConnectOpts(t),n=ji(this.rpc),r=n.required,a=n.optional,e.prev=4,e.next=7,new Promise(function(){var e=(0,s.Z)((0,i.Z)().mark((function e(n,s){var o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.rpc.showQrModal&&(null==(o=p.modal)||o.subscribeModal((function(e){!e.open&&!p.signer.session&&(p.signer.abortPairingAttempt(),s(new Error("Connection request reset. Please try again.")))}))),e.next=3,p.signer.connect(Mi(Ti({namespaces:(0,u.Z)({},p.namespace,r)},a&&{optionalNamespaces:(0,u.Z)({},p.namespace,a)}),{pairingTopic:null===t||void 0===t?void 0:t.pairingTopic})).then((function(e){n(e)})).catch((function(e){s(new Error(e.message))}));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 7:if(o=e.sent){e.next=10;break}return e.abrupt("return");case 10:this.setChainIds(this.rpc.chains),c=(0,f.gu)(o.namespaces,[this.namespace]),this.setAccounts(c),this.events.emit("connect",{chainId:Li(this.chainId)}),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(4),this.signer.logger.error(e.t0),e.t0;case 18:return e.prev=18,this.modal&&this.modal.closeModal(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[4,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.session,!e.t0){e.next=4;break}return e.next=4,this.signer.disconnect();case 4:this.reset();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isWalletConnect",get:function(){return!0}},{key:"session",get:function(){return this.signer.session}},{key:"registerEventListeners",value:function(){var e=this;this.signer.on("session_event",(function(t){var n=t.params.event;"accountsChanged"===n.name?(e.accounts=e.parseAccounts(n.data),e.events.emit("accountsChanged",e.accounts)):"chainChanged"===n.name?e.setChainId(e.formatChainId(n.data)):e.events.emit(n.name,n.data),e.events.emit("session_event",t)})),this.signer.on("chainChanged",(function(t){var n=parseInt(t);e.chainId=n,e.events.emit("chainChanged",Li(e.chainId)),e.persist()})),this.signer.on("session_update",(function(t){e.events.emit("session_update",t)})),this.signer.on("session_delete",(function(t){e.reset(),e.events.emit("session_delete",t),e.events.emit("disconnect",Mi(Ti({},(0,f.D6)("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))})),this.signer.on("display_uri",(function(t){var n,r;e.rpc.showQrModal&&(null==(n=e.modal)||n.closeModal(),null==(r=e.modal)||r.openModal({uri:t})),e.events.emit("display_uri",t)}))}},{key:"setHttpProvider",value:function(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}},{key:"isCompatibleChainId",value:function(e){return"string"==typeof e&&e.startsWith("".concat(this.namespace,":"))}},{key:"formatChainId",value:function(e){return"".concat(this.namespace,":").concat(e)}},{key:"parseChainId",value:function(e){return Number(e.split(":")[1])}},{key:"setChainIds",value:function(e){var t=this,n=e.filter((function(e){return t.isCompatibleChainId(e)})).map((function(e){return t.parseChainId(e)}));n.length&&(this.chainId=n[0],this.events.emit("chainChanged",Li(this.chainId)),this.persist())}},{key:"setChainId",value:function(e){if(this.isCompatibleChainId(e)){var t=this.parseChainId(e);this.chainId=t,this.setHttpProvider(t)}}},{key:"parseAccountId",value:function(e){var t=e.split(":"),n=(0,r.Z)(t,3),i=n[0],s=n[1],a=n[2];return{chainId:"".concat(i,":").concat(s),address:a}}},{key:"setAccounts",value:function(e){var t=this;this.accounts=e.filter((function(e){return t.parseChainId(t.parseAccountId(e).chainId)===t.chainId})).map((function(e){return t.parseAccountId(e).address})),this.events.emit("accountsChanged",this.accounts)}},{key:"getRpcConfig",value:function(e){var t,n,r=this;return{chains:(null==(t=e.chains)?void 0:t.map((function(e){return r.formatChainId(e)})))||["".concat(this.namespace,":1")],optionalChains:e.optionalChains?e.optionalChains.map((function(e){return r.formatChainId(e)})):void 0,methods:(null===e||void 0===e?void 0:e.methods)||Ii,events:(null===e||void 0===e?void 0:e.events)||Si,optionalMethods:(null===e||void 0===e?void 0:e.optionalMethods)||[],optionalEvents:(null===e||void 0===e?void 0:e.optionalEvents)||[],rpcMap:(null===e||void 0===e?void 0:e.rpcMap)||this.buildRpcMap(e.chains.concat(e.optionalChains||[]),e.projectId),showQrModal:Boolean(null===e||void 0===e?void 0:e.showQrModal),qrModalOptions:null!=(n=null===e||void 0===e?void 0:e.qrModalOptions)?n:void 0,projectId:e.projectId,metadata:e.metadata}}},{key:"buildRpcMap",value:function(e,t){var n=this,r={};return e.forEach((function(e){r[e]=n.getRpcUrl(e,t)})),r}},{key:"initialize",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var r,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.rpc=this.getRpcConfig(t),this.chainId=zi(this.rpc.chains),e.next=4,ki.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata});case 4:return this.signer=e.sent,this.registerEventListeners(),e.next=8,this.loadPersistedSession();case 8:if(!this.rpc.showQrModal){e.next=20;break}return e.prev=9,e.next=12,n.e(185).then(n.bind(n,72185));case 12:r=e.sent,s=r.Web3Modal,this.modal=new s(Ti({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions)),e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(9),new Error("To use QR modal, please install @web3modal/standalone package");case 20:case"end":return e.stop()}}),e,this,[[9,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"loadConnectOpts",value:function(e){var t=this;if(e){var n=e.chains,r=e.optionalChains,i=e.rpcMap;n&&(0,f.qt)(n)&&(this.rpc.chains=n.map((function(e){return t.formatChainId(e)})),n.forEach((function(e){t.rpc.rpcMap[e]=(null===i||void 0===i?void 0:i[e])||t.getRpcUrl(e)}))),r&&(0,f.qt)(r)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=null===r||void 0===r?void 0:r.map((function(e){return t.formatChainId(e)})),r.forEach((function(e){t.rpc.rpcMap[e]=(null===i||void 0===i?void 0:i[e])||t.getRpcUrl(e)})))}}},{key:"getRpcUrl",value:function(e,t){var n;return(null==(n=this.rpc.rpcMap)?void 0:n[e])||"".concat("https://rpc.walletconnect.com/v1/","?chainId=eip155:").concat(e,"&projectId=").concat(t||this.rpc.projectId)}},{key:"loadPersistedSession",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.session){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.signer.client.core.storage.getItem("".concat(this.STORAGE_KEY,"/chainId"));case 4:t=e.sent,this.setChainIds(t?[this.formatChainId(t)]:this.session.namespaces[this.namespace].accounts),this.setAccounts(this.session.namespaces[this.namespace].accounts);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reset",value:function(){this.chainId=1,this.accounts=[]}},{key:"persist",value:function(){this.session&&this.signer.client.core.storage.setItem("".concat(this.STORAGE_KEY,"/chainId"),this.chainId)}},{key:"parseAccounts",value:function(e){var t=this;return"string"==typeof e||e instanceof String?[this.parseAccount(e)]:e.map((function(e){return t.parseAccount(e)}))}}],[{key:"init",value:function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){var r;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new e,t.next=3,r.initialize(n);case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),Vi=Ui},13730:function(e,t,n){n.d(t,{r:function(){return l}});var r=n(74165),i=n(15861),s=n(15671),a=n(43144),o=n(60136),c=n(29388),u=n(68041),p=n(31567),l=function(e){(0,o.Z)(n,e);var t=(0,c.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e)).events=new u.EventEmitter,r.hasRegisteredEventListeners=!1,r.connection=r.setConnection(e),r.connection.connected&&r.registerEventListeners(),r}return(0,a.Z)(n,[{key:"connect",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.connection,e.next=3,this.open(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.close();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"removeListener",value:function(e,t){this.events.removeListener(e,t)}},{key:"request",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.requestStrict((0,p.formatJsonRpcRequest)(t.method,t.params||[],(0,p.getBigIntRpcId)().toString()),n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"requestStrict",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n){var s=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=(0,i.Z)((0,r.Z)().mark((function e(i,a){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.connection.connected){e.next=9;break}return e.prev=1,e.next=4,s.open();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),a(e.t0);case 9:return s.events.on("".concat(t.id),(function(e){(0,p.isJsonRpcError)(e)?a(e.error):i(e.result)})),e.prev=10,e.next=13,s.connection.send(t,n);case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(10),a(e.t1);case 18:case"end":return e.stop()}}),e,null,[[1,6],[10,15]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setConnection",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.connection}},{key:"onPayload",value:function(e){this.events.emit("payload",e),(0,p.isJsonRpcResponse)(e)?this.events.emit("".concat(e.id),e):this.events.emit("message",{type:e.method,data:e.params})}},{key:"onClose",value:function(e){e&&3e3===e.code&&this.events.emit("error",new Error("WebSocket connection closed abnormally with code: ".concat(e.code," ").concat(e.reason?"(".concat(e.reason,")"):""))),this.events.emit("disconnect")}},{key:"open",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:this.connection,this.connection!==t||!this.connection.connected){e.next=3;break}return e.abrupt("return");case 3:if(this.connection.connected&&this.close(),"string"!==typeof t){e.next=8;break}return e.next=7,this.connection.open(t);case 7:t=this.connection;case 8:return this.connection=this.setConnection(t),e.next=11,this.connection.open();case 11:this.registerEventListeners(),this.events.emit("connect");case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connection.close();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"registerEventListeners",value:function(){var e=this;this.hasRegisteredEventListeners||(this.connection.on("payload",(function(t){return e.onPayload(t)})),this.connection.on("close",(function(t){return e.onClose(t)})),this.connection.on("error",(function(t){return e.events.emit("error",t)})),this.connection.on("register_error",(function(t){return e.onClose()})),this.hasRegisteredEventListeners=!0)}}]),n}(p.IJsonRpcProvider)}}]);